<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ken Collins" />
  <meta name="google-site-verification" content="W3DG-CkoWHypH24OfrGmGbMezvhC6AyLql4jLI7hXhI" />
  <meta name="description" content="The personal blog of Ken Collins." />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cleartype" content="on">
  <title>Jekyll-Style Blogging On Rails - Ken Collins @MetaSkills.net</title>
  <link rel="author" href="mailto:ken@metaskills.net" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/site/icon-57x57-2dc1878cbb26a72f6a2819a2959a45ce.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/site/icon-114x114-0f98048facce72f3ad247a009ea96f4a.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/site/icon-72x72-2744bec8e69ef81b753774e000caa98d.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/site/icon-60x60-07051b464dc0766991ee5ff852b094b6.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/site/icon-120x120-b042e116791abbbf98418647ac107fa1.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/site/icon-76x76-fe55f7ee2c9f030b64031197b06d42b7.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/site/icon-152x152-ba6a44bd01376645de8bd1ec76c06e04.png">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/site/icon-196x196-40d4187aec04946f3fc86d7c3103f603.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/site/icon-160x160-ce83115bd1f54907855b72c8ecdfe5dc.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/site/icon-96x96-7817af4c06b1cc48e5d14e8d061b0d0e.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/site/icon-16x16-5ca4ac15b854c68d6dd989fd7aeaf6c5.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/site/icon-32x32-d44229e428c67291a65f57aac0fc029d.png">
  <meta name="apple-mobile-web-app-title" content="MetaSkills">
  <meta name="application-name" content="MetaSkills" />
  <meta name="msapplication-TileImage" content="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <meta name="msapplication-TileColor" content="052838">
  <link rel="stylesheet" href="/assets/site-a864411acbd582736a5f389e093cc772.css">
</head>

  <body>
    <section class="ms-Page is-Post">
  <header class="ms-Page-header">
    <section class="ms-Page-header-bg">
      <object class="ms-Page-header-bg-svg" data="/assets/site/page-svg-d6ea380f6b530625d51eeeafaa44d925.svg" type="image/svg+xml"></object>
    </section>
    <section class="ms-Page-header-content">
      <div class="ms-Page-header-avatar">
<a class="ms-Avatar" href="/pages/colophon.html" title"About Ken Collins">
  <div class="ms-Avatar-flipable">
    <div class="ms-Avatar-front">
      <img class="ms-Avatar-img" alt="Ken Collins" src="/assets/site/avatar-87e53dd8cc99a37a2842f8918ea310e7.jpg">
    </div>
    <div class="ms-Avatar-back">
      <svg class="ms-Avatar-aboutme" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="350px" height="47px" viewBox="0 0 350 47" preserveAspectRatio="xMidYMax meet" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(1.000, 1.000)"><path d="M161.250 4.91 L-0.014 -0.12 L17.975 44.67 L178.787 37.22 L330.559 44.67 L347.824 -0.12 L161.250 4.91 Z" fill="#E4522A"/><g stroke="#FFFBE1"><path d="M275.89 25.53 L290.71 25.53 L287.55 20.31 L321.9 20.31 "/><path d="M276.55 22.54 L291.36 22.54 L288.2 17.33 L322.56 17.33 "/></g><g stroke="#FFFBE1"><path d="M72.76 25.53 L57.94 25.53 L61.1 20.31 L26.75 20.31 "/><path d="M72.1 22.54 L57.29 22.54 L60.45 17.33 L26.09 17.33 "/></g></g><path d="M89.184 15.23 L81.776 15.23 L81.724 15.52 C83.226 16.68 83.64 17.12 83.64 18.6 L83.641 31.76 L89.184 31.76 L89.184 27.43 L90.842 27.43 C91.955 27.43 92.19 28.05 92.19 29.04 L92.189 31.76 L97.732 31.76 L97.732 27.98 C97.732 24.92 96.9 24.04 93.64 24.04 L98.327 15.23 L92.189 15.23 L89.184 24.74 L89.184 15.23 Z M113.357 25.72 L113.357 21.99 L109.109 21.99 L109.109 19.14 L115.247 19.14 L115.247 15.23 L101.701 15.23 L101.649 15.52 C103.151 16.68 103.57 17.12 103.57 18.6 L103.566 31.76 L115.507 31.76 L115.507 28.03 L109.109 28.03 L109.109 25.72 L113.357 25.72 Z M119.346 15.23 L119.294 15.52 C120.797 16.68 121.21 17.12 121.21 18.6 L121.211 31.76 L126.754 31.76 L126.754 18.83 L129.008 18.83 C129.888 18.83 130.02 19.12 130.02 20 L130.018 31.76 L135.561 31.76 L135.561 19.84 C135.561 16.48 134.68 15.23 131.05 15.23 L119.346 15.23 Z M161.112 25.88 L161.112 26.92 C161.112 28.05 160.91 28.37 160.08 28.37 L159.014 28.37 C158.160 28.37 157.95 28.05 157.95 26.92 L157.952 20.26 C157.952 19.12 158.16 18.86 159.01 18.86 L160.076 18.86 C160.905 18.86 161.11 19.12 161.11 20.26 L161.112 23 L166.707 23 L166.707 20.05 C166.707 16.43 165.8 15.23 162.43 15.23 L156.631 15.23 C153.264 15.23 152.36 16.43 152.36 20.05 L152.357 26.53 C152.357 30.72 153.89 31.76 156.92 31.76 L162.433 31.76 C165.801 31.76 166.71 30.88 166.71 27.12 L166.707 25.88 L161.112 25.88 Z M186.606 20.05 C186.606 16.43 185.7 15.23 182.33 15.23 L176.375 15.23 C173.008 15.23 172.1 16.43 172.1 20.05 L172.101 26.53 C172.101 30.72 173.63 31.76 176.66 31.76 L182.332 31.76 C185.700 31.76 186.61 30.88 186.61 27.12 L186.606 20.05 Z M181.011 26.92 C181.011 28.05 180.8 28.37 179.97 28.37 L178.758 28.37 C177.903 28.37 177.7 28.05 177.7 26.92 L177.696 20.26 C177.696 19.12 177.9 18.86 178.76 18.86 L179.975 18.86 C180.804 18.86 181.01 19.12 181.01 20.26 L181.011 26.92 Z M198.216 15.23 L190.808 15.23 L190.757 15.52 C192.259 16.68 192.67 17.12 192.67 18.6 L192.673 31.76 L203.863 31.76 L203.863 28.03 L198.216 28.03 L198.216 15.23 Z M214.230 15.23 L206.822 15.23 L206.770 15.52 C208.272 16.68 208.69 17.12 208.69 18.6 L208.687 31.76 L219.877 31.76 L219.877 28.03 L214.230 28.03 L214.230 15.23 Z M230.244 15.23 L222.836 15.23 L222.784 15.52 C224.286 16.68 224.7 17.12 224.7 18.6 L224.700 31.76 L230.244 31.76 L230.244 15.23 Z M234.653 15.23 L234.601 15.52 C236.103 16.68 236.52 17.12 236.52 18.6 L236.518 31.76 L242.061 31.76 L242.061 18.83 L244.314 18.83 C245.195 18.83 245.32 19.12 245.32 20 L245.325 31.76 L250.868 31.76 L250.868 19.84 C250.868 16.48 249.99 15.23 246.36 15.23 L234.653 15.23 Z M268.410 15.23 L258.696 15.23 C256.805 15.23 256.13 16.06 256.13 17.36 C256.132 17.88 256.37 18.55 256.7 19.07 L261.753 27.07 C261.830 27.18 261.88 27.36 261.88 27.51 C261.882 27.82 261.65 28.03 261.18 28.03 L255.743 28.03 L255.743 31.76 L266.130 31.76 C268.073 31.76 268.8 30.49 268.8 29.45 C268.798 28.75 268.49 28.21 268.18 27.74 L262.970 20.13 C262.841 19.92 262.76 19.77 262.76 19.61 C262.763 19.33 263.02 19.14 263.49 19.14 L268.410 19.14 L268.410 15.23 Z" fill="#FFFBE1"/></g></svg>

    </div>
  </div>
</a>
</div>
      <ul class="ms-Page-nav">
        <li class="ms-Page-nav-item">
          <a class="ms-Page-nav-link" href="/">HOME</a>
        </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/programming.html">Programming</a>
          </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/lifestyle.html">Lifestyle</a>
          </li>
        
      </ul>
      <div class="ms-Page-social"><div class="ms-Social">
  <a href="http://twitter.com/metaskills" title="MetaSkills On Twitter">
    <span class="ms-Social-icon ms-Social-icon--twitter"><i class="icon-twitter"></i></span>
  </a>
  <a href="https://github.com/metaskills/" title="MetaSkills On GitHub">
    <span class="ms-Social-icon ms-Social-icon--github"><i class="icon-github"></i></span>
  </a>
  <a href="http://www.linkedin.com/in/metaskills" title="Ken Collins On LinkedIn">
    <span class="ms-Social-icon ms-Social-icon--linkedin"><i class="icon-linkedin"></i></span>
  </a>
</div>
</div>
      <div class="ms-Page-blurb">
        Ruby, JavaScript, Sass, iOS. Stinky Cheese &amp; Beer Advocate. Working at CustomInk and loving it!
      </div>
    </section>
  </header>
  <article class="ms-Page-article">
    <article class="ms-Post">
  <header class="ms-Post-header">
    <time class="ms-Post-time" pubdate datetime="2014-04-19T00:00:00-04:00">
      2014 April 19
    </time>
    <h1 class="ms-Post-header-h1">Jekyll-Style Blogging On Rails</h1>
  </header>
  <p><img src="/assets/jekyll-on-rails.png" class="ms-Img ms-Img--responsive" />
Do you want to use your existing Rails&#39; layouts &amp; business logic for your new Blog? Do you know and love <a href="http://jekyllrb.com">Jekyll</a>, but cant seem to get the two to play nice together?</p>

<p>In the spirit of <a href="http://c2.com/cgi/wiki?DoSimpleThings">doing the simplest thing</a> that could possibly work, I set out on a solution to this problem. Besides mimicing Jekyll as closely as possible, my requirements were loosly defined as:</p>

<ul>
<li>Use a directory of markdown files with a <code>YYYY-MM-DD-blog-post-title.md</code> naming convention.</li>
<li>Have fast syntax highlighting via fenced code blocks.</li>
<li>Expose model class finders for a single resource &amp; collections.</li>
<li>Some model object to ask posts for their title, date, html, etc.</li>
<li>Make local development follow Rails conventions. Like page refreshes.</li>
<li>Provide a reasonable amount of caching in production.</li>
</ul>

<p>Additionally if I had time or the gumption:</p>

<ul>
<li>Use YAML front matter for different post titles &amp; other options.</li>
<li>Preprocess markdown with ERB and allow Rails routes &amp; helpers to be used.</li>
<li>Ask each post for an excerpt so we can render teasers elsewhere.</li>
<li>Create a rake task that tees up a new post using the current date.</li>
</ul>

<h2 id="getting-started">Getting Started</h2>

<p>Most times I like to start coding to high-level interfaces. It helps me think about the smaller details I will need to build later. A Rails controller is a good option but be careful and keep it simple! If you are the type of person that likes to jump to the end, check out <a href="https://gist.github.com/metaskills/11071934">the final gist</a> of our completed work.</p>

<p>First, we are going to make our blog routes and controller. We want two actions, an <code>index</code> to list all blog posts and a <code>show</code> to render each post.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># In config/routes.rb</span>
<span class="n">resources</span> <span class="ss">:blog</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

<span class="c1"># In app/controllers/blog_controller.rb</span>
<span class="k">class</span> <span class="nc">BlogController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">layout</span> <span class="s1">'site'</span>
  <span class="n">before_filter</span> <span class="ss">:find_post</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">BlogPost</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="n">render</span> <span class="ss">text: </span><span class="vi">@post</span><span class="p">.</span><span class="nf">html</span><span class="p">,</span> <span class="ss">layout: </span><span class="s1">'site'</span> <span class="k">if</span> <span class="n">stale?</span> <span class="vi">@post</span><span class="p">,</span> <span class="ss">public: </span><span class="kp">true</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">find_post</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">BlogPost</span><span class="p">.</span><span class="nf">find</span> <span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">]</span>
    <span class="n">redirect_to</span> <span class="n">blog_index_path</span> <span class="k">unless</span> <span class="vi">@post</span>
  <span class="k">end</span>

<span class="k">end</span>

</code></pre></div>
<p>Pretty simple looking, but this code exposes some neat details that we will have to build while accomplishing a lot too. Our <code>index</code> action shows we will need a class finder for all posts and assumes they will be ordered somehow. The <code>show</code> action which is behind our <code>find_post</code> filter tells us we need some type of key for our posts – likewise we have determined that we need an <code>html</code> instance method. Lastly, we are going to check when a post is stale somehow while setting the public Cache-Control header for proxies.</p>

<h2 id="our-blogpost-model">Our BlogPost Model</h2>

<p>Our <code>:id</code> key will use the file name as our <a href="http://en.wikipedia.org/wiki/Clean_URL#Slug">slug</a>. Our markdown files will be located where our controller would normally find them, in the <code>app/views/blog</code> directory. Feel free to create your first post there, name it <code>2014-04-19-my-first-post.md</code> using the current date. Now here is our first itteration of our new <code>BlogPost</code> model that allows us to find our posts.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>

  <span class="kp">attr_reader</span> <span class="ss">:slug</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>

    <span class="k">def</span> <span class="nf">all</span>
      <span class="n">all_slugs</span><span class="p">.</span><span class="nf">map</span><span class="p">{</span> <span class="o">|</span><span class="n">slug</span><span class="o">|</span> <span class="kp">new</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span> <span class="p">}.</span><span class="nf">sort</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
      <span class="n">all</span><span class="p">.</span><span class="nf">detect</span> <span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">slug</span> <span class="o">==</span> <span class="n">slug</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">directory</span>
      <span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span> <span class="s1">'app'</span><span class="p">,</span> <span class="s1">'views'</span><span class="p">,</span> <span class="s1">'blog'</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">all_slugs</span>
      <span class="vi">@all_slugs</span> <span class="o">||=</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">directory</span><span class="si">}</span><span class="s2">/*.md"</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">f</span><span class="p">).</span><span class="nf">sub</span><span class="p">(</span><span class="sr">/\.md$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">end</span>

  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
    <span class="vi">@slug</span> <span class="o">=</span> <span class="n">slug</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<p>Notice how we memoize the private <code>all_slugs</code> class method to avoid hiting the filesystem again and again in production? This idea is definitly not complete and if needed, we can update it later. So, with the class methods out of the way, we can flesh out the model more. But first, we need to think about Jekyll.</p>

<h2 id="time-for-jekyll">Time For Jekyll</h2>

<p>I&#39;ve used Jekyll for a handful of static sites and blogs. Most of which have been running the next major version which is not quite out yet. Jekyll v2 is amazing and we totally need it for this project. Below are the gem deps you will need to bundle up. Remember, when Jekyll v2 is released, you can change your Gemfile as needed.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># In Gemfile</span>
<span class="n">gem</span> <span class="s1">'jekyll'</span><span class="p">,</span> <span class="s1">'~&gt; 2.0.0.alpha'</span>
<span class="n">gem</span> <span class="s1">'redcarpet'</span>
<span class="n">gem</span> <span class="s1">'rouge'</span>
</code></pre></div>
<p>So, most of us are familiar with the <a href="https://github.com/vmg/redcarpet">Redcarpet</a> gem. That will be the markdown converter we use, but what about rouge? The <a href="https://github.com/jayferd/rouge">Rouge</a> gem is a pure-ruby syntax highlighter. It can highlight over 60 languages, and output HTML or ANSI 256-color text. Its HTML output is compatible with existing stylesheets designed for pygments.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>

  <span class="c1"># ...</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">to_html</span>
    <span class="no">Jekyll</span><span class="o">::</span><span class="no">Converters</span><span class="o">::</span><span class="no">Markdown</span><span class="o">::</span><span class="no">RedcarpetParser</span><span class="p">.</span><span class="nf">new</span><span class="p">({</span>
      <span class="s1">'highlighter'</span> <span class="o">=&gt;</span> <span class="s1">'rouge'</span><span class="p">,</span>
      <span class="s1">'redcarpet'</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">'extensions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s2">"no_intra_emphasis"</span><span class="p">,</span> <span class="s2">"fenced_code_blocks"</span><span class="p">,</span> <span class="s2">"autolink"</span><span class="p">,</span>
          <span class="s2">"strikethrough"</span><span class="p">,</span> <span class="s2">"lax_spacing"</span><span class="p">,</span>  <span class="s2">"superscript"</span><span class="p">,</span> <span class="s2">"with_toc_data"</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}).</span><span class="nf">convert</span><span class="p">(</span><span class="n">markdown</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<p>It is not just sexy, Rouge is fast too! And by using it, we avoid bundling to pygments which has Python dependencies. We are going to let Jekyll do the heavy lifting and implement our private <code>to_html</code> method like so. This will give us Github flavored markdown using Rouge for our fenced code blocks.</p>

<h2 id="other-blogpost-details">Other BlogPost Details</h2>

<p>In our <code>BlogPost.all</code> class method, we called sort on the collection with the expectation that the newest post comes first. To fulfill this we are going to use Ruby&#39;s <code>&lt;=&gt;</code> spaceship operator by comparing each post&#39;s date. This completes our controller&#39;s <code>index</code> requirement.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nf">&lt;</span><span class="o">=&gt;</span> <span class="n">other</span>
    <span class="n">other</span><span class="p">.</span><span class="nf">date</span> <span class="o">&lt;=&gt;</span> <span class="n">date</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>We want each post to have a <code>title</code> and <code>date</code> method. We can easily parse these form the slug. I even made a <code>date_formatted</code> method using ActiveSupport&#39;s Inflector that will be useful for our views. It returns date strings like April 19th, 2014. We also have a <code>path</code> method that we can use when linking to our posts from elsewhere in our site. It will use the slug as the <code>:id</code> param. This completes our controller&#39;s <code>find_post</code> requirement and gives us pretty URLs just like Jekyll.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nf">title</span>
    <span class="n">slug</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="sr">/\d{4}-\d{2}-\d{2}-/</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nf">titleize</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">date</span>
    <span class="no">Date</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">slug</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">date_formatted</span>
    <span class="n">day_format</span> <span class="o">=</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Inflector</span><span class="p">.</span><span class="nf">ordinalize</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="nf">day</span><span class="p">)</span>
    <span class="n">date</span><span class="p">.</span><span class="nf">strftime</span> <span class="s2">"%B </span><span class="si">#{</span><span class="n">day_format</span><span class="si">}</span><span class="s2">, %G"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">path</span>
    <span class="s2">"/blog/</span><span class="si">#{</span><span class="n">slug</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>Before implementing our markdown to HTML conversion, we should think about caching. Following Rails&#39; <a href="http://guides.rubyonrails.org/caching_with_rails.html">conventions</a> we implment a <code>cache_key</code> method that combines the blog namespace with the posts unique slug and timestamp. The <code>updated_at</code> timestamp is simply the last time the file was modified on disk. Convention is to convert this to an integer which is seconds since Unix Epoch. The <code>cache_key</code> will be used by the controller&#39;s <code>show</code> method when determining the ETag for the response.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nf">updated_at</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">mtime</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">cache_key</span>
    <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Cache</span><span class="p">.</span><span class="nf">expand_cache_key</span> <span class="p">[</span><span class="s1">'blog'</span><span class="p">,</span> <span class="n">slug</span><span class="p">,</span> <span class="n">updated_at</span><span class="p">.</span><span class="nf">to_i</span><span class="p">]</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>Now the fun part, converting our markdown to HTML. We are going to use the <code>Rails.cache</code> which in local development is a simple memory store and Memcached in production. The <code>fetch</code> method takes a key and a block. The block is only executed if there is a cache miss.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">BlogPost</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nf">html</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">cache</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">/html"</span><span class="p">)</span> <span class="p">{</span> <span class="n">to_html</span> <span class="p">}</span>
  <span class="k">end</span>


  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">file_path</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">directory</span><span class="p">.</span><span class="nf">join</span> <span class="s2">"</span><span class="si">#{</span><span class="n">slug</span><span class="si">}</span><span class="s2">.md"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">markdown</span>
    <span class="no">Rails</span><span class="p">.</span><span class="nf">cache</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">cache_key</span><span class="si">}</span><span class="s2">/markdown"</span><span class="p">)</span> <span class="p">{</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<h2 id="code-highlighting">Code Highlighting</h2>

<p>The only thing left to do is style the highlighted output from the Rouge gem. Thankfully, there are many existing pygment theme options spread accross the internet. Here are a few to get you started.</p>

<ul>
<li><a href="https://github.com/richleland/pygments-css">pygments-css</a> - CSS files created from pygment&#39;s built-in styles.</li>
<li><a href="https://github.com/StylishThemes/GitHub-Dark/">GitHub-Dark</a> - GitHub Dark theme for Stylish. Browse the themes directory.</li>
<li><a href="https://github.com/aahan/pygments-github-style">pygments-github-style</a> - GitHub style for Pygments.</li>
</ul>

<p>For the <a href="http://homemarks.com/">HomeMarks</a> blog, I used the github <code>jekyll-github.css</code> from the last resource above. Have fun choosing your own and <code>@import</code> it into your existing CSS bundle in the manner that matches your own project.</p>

<h2 id="taking-it-further?">Taking It Further?</h2>

<p>So that&#39;s it, we can ship it! But what about those other great requirements like YAML front matter, ERB templates, Rails&#39; routes/helpers, and more? The good news is that I found the time to do them all. You can find each implemented in the final <a href="https://gist.github.com/metaskills/11071934">Jekyll-Style Blogging On Rails</a> gist.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">scope</span>
  <span class="no">ApplicationController</span><span class="p">.</span><span class="nf">helpers</span><span class="p">.</span><span class="nf">clone</span><span class="p">.</span><span class="nf">tap</span> <span class="k">do</span> <span class="o">|</span><span class="n">h</span><span class="o">|</span>
    <span class="n">h</span><span class="p">.</span><span class="nf">singleton_class</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:include</span><span class="p">,</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">url_helpers</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>One aspect that I was particularly proud of was ERB pre-processing with a evaluation scope to Rails&#39; routes and helpers. The solution turned out to be simple after digging into the <a href="https://github.com/rails/rails/tree/4-1-stable/railties/lib/rails/console">railties IRB console</a> helpers and ActionPack. My solution above used this <code>scope</code> with the Tilt&#39;s erubis template.</p>

<h2 id="where-to-go-from-here?">Where To Go From Here?</h2>

<p>With <a href="https://gist.github.com/metaskills/11071934">this setup</a>, you have a great foundation for Jekyll on Rails. Feel free to customize it as needed. Some ideas include:</p>

<ul>
<li>Better caching in production. Currently hits the filesystem for <code>cache_key</code>.</li>
<li>Maybe make a jekyll-rails engine that does all of this for you?</li>
<li>Add an Emoji HTML filter to your posts.</li>
</ul>

<h2 id="resources">Resources</h2>

<p>Thanks for reading! Would love to hear your feedback too.</p>

<ul>
<li><a href="https://gist.github.com/metaskills/11071934">The Final &quot;Jekyll-Style Blogging On Rails&quot; Gist</a></li>
<li><a href="http://c2.com/cgi/wiki?DoSimpleThings">Do Simple Things</a></li>
</ul>

  <footer class="ms-Post-footer">
    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2014/04/19/jekyll-style-blogging-on-rail';
  var disqus_title = "Jekyll-Style Blogging On Rails";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  </footer>
</article>

    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2014/04/19/jekyll-style-blogging-on-rail';
  var disqus_title = "Jekyll-Style Blogging On Rails";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


    <footer class="ms-Footer">
  <p>
    &copy; 2006-2014 Ken Collins. All rights reserved.<br/>
    MetaSkills.net is powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://disqus.com">Disqus</a>.
  </p>
</footer>

  </article>
</section>

    <script src="/assets/site-5b742dd84d08dc11c2e75947ba53428e.js"></script>
  </body>
</html>
