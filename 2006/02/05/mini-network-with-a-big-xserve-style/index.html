<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ken Collins" />
  <meta name="google-site-verification" content="W3DG-CkoWHypH24OfrGmGbMezvhC6AyLql4jLI7hXhI" />
  <meta name="description" content="The personal blog of Ken Collins aka MetaSkills" />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cleartype" content="on">
  
  <title>Mini Network with a Big XServe Style - Ken Collins @MetaSkills.net</title>
  <link rel="author" href="mailto:ken@metaskills.net" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/site/icon-57x57.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/site/icon-114x114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/site/icon-72x72.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/site/icon-144x144.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/site/icon-60x60.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/site/icon-120x120.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/site/icon-76x76.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/site/icon-152x152.png">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/site/icon-196x196.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/site/icon-160x160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/site/icon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/site/icon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/site/icon-32x32.png">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://metaskills.net/feed.xml" />
  <meta name="apple-mobile-web-app-title" content="MetaSkills">
  <meta name="application-name" content="MetaSkills" />
  <meta name="msapplication-TileImage" content="/assets/site/icon-144x144.png">
  <meta name="msapplication-TileColor" content="052838">
  <link rel="stylesheet" href="/assets/site.css">
</head>

  <body>
    <section class="ms-Page ">
  <header class="ms-Page-header">
    <section class="ms-Page-header-bg">
      <object class="ms-Page-header-bg-svg" data="/assets/site/page-svg.svg" type="image/svg+xml"></object>
    </section>
    <section class="ms-Page-header-content">
      <div class="ms-Page-header-avatar">
<a class="ms-Avatar" href="/pages/colophon.html" title"About Ken Collins">
  <div class="ms-Avatar-flipable">
    <div class="ms-Avatar-front">
      <img class="ms-Avatar-img" alt="Ken Collins" src="/assets/site/avatar.jpg">
    </div>
    <div class="ms-Avatar-back">
      <svg class="ms-Avatar-aboutme" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="350px" height="47px" viewBox="0 0 350 47" preserveAspectRatio="xMidYMax meet" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(1.000, 1.000)"><path d="M161.250 4.91 L-0.014 -0.12 L17.975 44.67 L178.787 37.22 L330.559 44.67 L347.824 -0.12 L161.250 4.91 Z" fill="#E4522A"/><g stroke="#FFFBE1"><path d="M275.89 25.53 L290.71 25.53 L287.55 20.31 L321.9 20.31 "/><path d="M276.55 22.54 L291.36 22.54 L288.2 17.33 L322.56 17.33 "/></g><g stroke="#FFFBE1"><path d="M72.76 25.53 L57.94 25.53 L61.1 20.31 L26.75 20.31 "/><path d="M72.1 22.54 L57.29 22.54 L60.45 17.33 L26.09 17.33 "/></g></g><path d="M89.184 15.23 L81.776 15.23 L81.724 15.52 C83.226 16.68 83.64 17.12 83.64 18.6 L83.641 31.76 L89.184 31.76 L89.184 27.43 L90.842 27.43 C91.955 27.43 92.19 28.05 92.19 29.04 L92.189 31.76 L97.732 31.76 L97.732 27.98 C97.732 24.92 96.9 24.04 93.64 24.04 L98.327 15.23 L92.189 15.23 L89.184 24.74 L89.184 15.23 Z M113.357 25.72 L113.357 21.99 L109.109 21.99 L109.109 19.14 L115.247 19.14 L115.247 15.23 L101.701 15.23 L101.649 15.52 C103.151 16.68 103.57 17.12 103.57 18.6 L103.566 31.76 L115.507 31.76 L115.507 28.03 L109.109 28.03 L109.109 25.72 L113.357 25.72 Z M119.346 15.23 L119.294 15.52 C120.797 16.68 121.21 17.12 121.21 18.6 L121.211 31.76 L126.754 31.76 L126.754 18.83 L129.008 18.83 C129.888 18.83 130.02 19.12 130.02 20 L130.018 31.76 L135.561 31.76 L135.561 19.84 C135.561 16.48 134.68 15.23 131.05 15.23 L119.346 15.23 Z M161.112 25.88 L161.112 26.92 C161.112 28.05 160.91 28.37 160.08 28.37 L159.014 28.37 C158.160 28.37 157.95 28.05 157.95 26.92 L157.952 20.26 C157.952 19.12 158.16 18.86 159.01 18.86 L160.076 18.86 C160.905 18.86 161.11 19.12 161.11 20.26 L161.112 23 L166.707 23 L166.707 20.05 C166.707 16.43 165.8 15.23 162.43 15.23 L156.631 15.23 C153.264 15.23 152.36 16.43 152.36 20.05 L152.357 26.53 C152.357 30.72 153.89 31.76 156.92 31.76 L162.433 31.76 C165.801 31.76 166.71 30.88 166.71 27.12 L166.707 25.88 L161.112 25.88 Z M186.606 20.05 C186.606 16.43 185.7 15.23 182.33 15.23 L176.375 15.23 C173.008 15.23 172.1 16.43 172.1 20.05 L172.101 26.53 C172.101 30.72 173.63 31.76 176.66 31.76 L182.332 31.76 C185.700 31.76 186.61 30.88 186.61 27.12 L186.606 20.05 Z M181.011 26.92 C181.011 28.05 180.8 28.37 179.97 28.37 L178.758 28.37 C177.903 28.37 177.7 28.05 177.7 26.92 L177.696 20.26 C177.696 19.12 177.9 18.86 178.76 18.86 L179.975 18.86 C180.804 18.86 181.01 19.12 181.01 20.26 L181.011 26.92 Z M198.216 15.23 L190.808 15.23 L190.757 15.52 C192.259 16.68 192.67 17.12 192.67 18.6 L192.673 31.76 L203.863 31.76 L203.863 28.03 L198.216 28.03 L198.216 15.23 Z M214.230 15.23 L206.822 15.23 L206.770 15.52 C208.272 16.68 208.69 17.12 208.69 18.6 L208.687 31.76 L219.877 31.76 L219.877 28.03 L214.230 28.03 L214.230 15.23 Z M230.244 15.23 L222.836 15.23 L222.784 15.52 C224.286 16.68 224.7 17.12 224.7 18.6 L224.700 31.76 L230.244 31.76 L230.244 15.23 Z M234.653 15.23 L234.601 15.52 C236.103 16.68 236.52 17.12 236.52 18.6 L236.518 31.76 L242.061 31.76 L242.061 18.83 L244.314 18.83 C245.195 18.83 245.32 19.12 245.32 20 L245.325 31.76 L250.868 31.76 L250.868 19.84 C250.868 16.48 249.99 15.23 246.36 15.23 L234.653 15.23 Z M268.410 15.23 L258.696 15.23 C256.805 15.23 256.13 16.06 256.13 17.36 C256.132 17.88 256.37 18.55 256.7 19.07 L261.753 27.07 C261.830 27.18 261.88 27.36 261.88 27.51 C261.882 27.82 261.65 28.03 261.18 28.03 L255.743 28.03 L255.743 31.76 L266.130 31.76 C268.073 31.76 268.8 30.49 268.8 29.45 C268.798 28.75 268.49 28.21 268.18 27.74 L262.970 20.13 C262.841 19.92 262.76 19.77 262.76 19.61 C262.763 19.33 263.02 19.14 263.49 19.14 L268.410 19.14 L268.410 15.23 Z" fill="#FFFBE1"/></g></svg>

    </div>
  </div>
</a>
</div>
      <ul class="ms-Page-nav">
        <li class="ms-Page-nav-item">
          <a class="ms-Page-nav-link" href="/">HOME</a>
        </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/programming.html">Programming</a>
          </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/lifestyle.html">Lifestyle</a>
          </li>
        
      </ul>
      <div class="ms-Page-social"><div class="ms-Social">
  <a href="http://twitter.com/metaskills" title="MetaSkills On Twitter">
    <span class="ms-Social-icon ms-Social-icon--twitter"><i class="icon-twitter"></i></span>
  </a>
  <a href="https://github.com/metaskills/" title="MetaSkills On GitHub">
    <span class="ms-Social-icon ms-Social-icon--github"><i class="icon-github"></i></span>
  </a>
  <a href="http://www.linkedin.com/in/metaskills" title="Ken Collins On LinkedIn">
    <span class="ms-Social-icon ms-Social-icon--linkedin"><i class="icon-linkedin"></i></span>
  </a>
</div>
</div>
      <div class="ms-Page-blurb">
        Ruby, JavaScript, Sass, iOS. Stinky Cheese &amp; Beer Advocate. Working at CustomInk and loving it!
      </div>
    </section>
  </header>
  <article class="ms-Page-article">
    <article class="ms-Post">
  <header class="ms-Post-header">
    <time class="ms-Post-time" pubdate datetime="2006-02-05T00:00:00-05:00">
      2006 February 05
    </time>
    <h1 class="ms-Post-header-h1">Mini Network with a Big XServe Style</h1>
  </header>
  <p>Or, how to be the biggest network geek you can  in only 1 square foot of space. Starting last year after  reading <a href="http://mundy.org/blog/index.php?p=40">Ward Mundy's How-To Bonanza</a>, I knew I needed to use the Mac Mini as the core hardware component for my home network. Mostly because it looks good and small form fits easily on my desk. Good as that might be, the Mac Minis do have drawbacks and, if you're serious about your hosting choices, these do have to be overcome; this is what my post is all about.  </p>

<p> So like most people that create networks I did not realize that the Mac Mini includes 3 high speed  network interfaces and  that with a little bit of work and the right architecture they can be used  to operate in much the same manner one would  see in a high-end network operations centers. I manage one such NOC and I wanted my home network  to function like most companies who do serious business online. These features typically include:</p>

<ul>
  <li>Internal LAN Network Interfaces - (10.0.1.0/24 Addresses) </li>
  <li>Internal Perimeter Network (DMZ) Behind a NAT or Port Forwarding Firewall </li>
  <li>Both Internal (LAN) and External (Public) DNS Services </li>
  <li>IP Over Firewire  Connections - (192.168.1.0/25 Addresses) </li>
  <li>Hard Drive Redundancy and Backup Using RsyncX - (typically RAID 1 or 5)</li>
</ul>

<h2>Starting At The End</h2>

<p>Below is a simple diagram of my final network. I had to lose a few features from the list above or even change their  meaning a bit, but I did end up with a network that utilizes most of them.</p>

<p><img src="/assets/simple-mac-mini-network-diagram.jpg" alt="Most Advanced Simple Mac Mini Network Diagram" class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<h2>Public Interfaces</h2>

<p>In the diagram above, the (green) represents public 100baseT ethernet interfaces while (orange) and (red) represent an internal network. Due to many questions regarding this layout, I want to stress that the WebSvr and generic Mini (mail and DNS) are publicly available on the 100baseT connections through my Linksys switch. The AirPort is for local LAN only, see below for details.</p>

<h2>Internal Local Area Network ( LAN ) </h2>

<p>First thing on the list that is the most important feature. A local area network that allows connections to each server without going outside to the public internet and thus taking up valuable bandwidth to those public interfaces. It's also good for security! The AirPort Extreme I had did this quite well by setting it to share a network connection using DHCP and NAT on the 10.0.1.0/24 subnet. The AirPort internet connection is setup to DHCP to my ISP from its WAN port. Each Mac Mini's AirPort network interface is manually set on its own IP address that never changes. This will need to be done so you can assign it an internal DNS name and reverse PTR record.</p>

<h2>Internal DNS Services ( WebSvr Mini )</h2>

<p>Now that we have an internal LAN  we can use this to host our own DNS so that machines on the local network including my powerbooks and other systems will use the AirPort interfaces for services. For instance, if I browse to my website from home, I am not using the public interface and bandwidth, but rather the IP with the AirPort address. The WebSvr Mini was my best choice for hosting DNS and I have BIND 9 configured to only listen for queries on the local 127.0.0.1 IP and its own 10.0.1.x AirPort IP address. BIND is also configured to forward all unknown queries to my ISP. It's very important to set the basestation's internet tab be set to use the WebSvr Mini's 10.0.1.x AirPort IP address for DNS, rather than your ISP. In this way, all clients that are not manually configured to do so will use the WebSvr mini for DNS and hence the AirPort interfaces on each server for services. I hope I have not lost you yet. When using internal DNS the right way, all local traffic such as Apache, Apple Remote Desktop, MySQL, SSH, etc. are all done locally and fast. So do not forget to tell Apache it can listen on that port.</p>

<h2>IP Over Firewire Database Connection ( DbSvr Mini )  </h2>

<p>The DdSvr Mini is using Apple's IP over firewire capabilities to connect to the WebSvr Mini. I have a patch cable connected to the WebSvr Mini with static IP addresses on both ends using the 192.168.1.0/24 subnet. For convenience each of the 192. addresses ends with the same number as their respective 10. AirPort addresses. This is the 3rd network interface that most people are not aware of. It has limitations but used wisely it can be very useful and fast. In the set up above I am able to keep all database traffic entirely off of my internal switch and localized to that one patch cable. Unless of course, I decide to access the DbSvr Mini using its LAN/AirPort address. Either way, this machine is totally off the public network and quite secure.</p>

<h2>Other Services ( Mail and External DNS )</h2>

<p>That's what the other unlabeled Mini is for. I have it configured to for mail and public DNS. Postfix is happily listening on its public and private addresses while DNS is only listening on the public IP. This server also does not have an external drive (see below) since I am not worried about its performance since the overhead is quite low for those two services. </p>

<h2>Firewall Services </h2>

<p>In this setup I did loose the ability to have private addresses for my two public Minis. Hard core network engineers would point out that this would be another layer of security by having a single firewall/router filter and translate packets to these two boxes. I agree and it makes for a nice portable network too. But, I am more than happy running the ipfw service built into OS X Server that is running on each Mac Mini. It is a great stateful firewall and it's not really a configuration nightmare to maintain each one. All in all, it's what I call the RONCO network, set it and forget it. Now on to fixing some of the deficiencies for the Mac Mini. </p>

<h2>Improving Hard Drive Performance </h2>

<p>One of the first drawbacks to the mac mini is its poor hard drive speed. This can be a real big hit on performance when it comes to hosting a descent web or database server. Thankfully there are alternatives including  upgrading the internal drive with a faster  form factory laptop drive. However, these can be expensive and if you are like me and have a few Barracuda 7200 RPM 3.5 inch external drives laying around, you could save a lot by purchasing an inexpensive firewire enclosure. I decided on the <a href="http://www.newertech.com/products/products_mini1.php">miniStack from newertechnology</a> since it had the best cooling features and good Mac Mini style. More importantly it sells with a driveless option and comes with firewire cables. A deal for only $69.00 for the entire kit. </p>

<p>I purchased (2) of these, one for each Mini who's performance I was really concerned about, one for the web server and one for the database server. Each of those Macs boot directly from that external drive connected via firewire, the internal drive is used as a back up. Currently I have the DbSvr Mini setup as an RsyncX server and every night each of the 3 servers backs up to its internal hard drive. That's a separate post in itself. </p>

<h2>Improving AirPort Signal Strength</h2>

<p>I was really surprised to find out how poor the Mac Mini's AirPort signal strength was  after you stack something on top of it. My extreme basestation was only a few feet away and the interference from the drive enclosures was so bad that I could not connect two of them that were in the middle of my stack. Thankfully, I was no stranger to <a href="http://www.pbfixit.com/Guide/82.11.0.html">taking apart my Mac Mini</a>. In fact, I had installed AirPort cards on all of them since it was cheaper for me to do so and I had an idea! So be warned, the following steps will  void your warranty - but if you want to get good AirPort strength and this was a must for me, here is some helpful instructions. </p>

<p>First though, the unordered list below is a parts list with links to Mac-Pro.com. If you are wanting to install an AirPort Extreme card in a Mac Mini, these are the parts you will need. Secondly, my AirPort signal strength &quot;fix&quot; below is by no means a comprehensive step by step for a first timer into the Mac Mini. I highly recommend <a href="http://www.pbfixit.com/Guide/82.0.0.html">PBFixIt.com's Mac Mini Take Apart Guide</a> for that. </p>

<ul>
  <li><a href="http://www.mac-pro.com/s.nl/sc.2/category.333/it.A/id.1719/.f">Mezzanine Board for Mac Mini</a></li>
  <li><a href="http://www.mac-pro.com/s.nl/sc.2/category.22/it.A/id.1720/.f">AirPort Antenna for Mac Mini</a></li>
  <li><a href="http://www.mac-pro.com/s.nl/sc.2/category.333/it.A/id.1853/.f">Screws for Mac Mini Mezzanine Board</a></li>
</ul>

<p>OK, now to the fun part, Improving your AirPort signal strength. You will need to get a good clean work area setup and take apart your Mac Mini down to the mezzanine board where your AirPort card is installed. Do not actually take that out, we are just going to reroute the cable. Just unplug the AirPort extreme antenna. </p>

<p><img src="/assets/getting-ready-to-work_large.jpg" alt="My best attempt at a clean work area. Remember to unplug the AirPort antenna from the extreme card." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>The most logical place to run the AirPort antenna externally is through the security hole on the back right side. The only other choice would have us drilling holes in the vents and the hood that funnels air out the back of the Mac Mini. Least invasive is good, so I took a dremel and widened that hole up. I made a circular opening the same diameter as the existing width of the security hole. </p>

<p><img src="/assets/expanding-security-hole_large.jpg" alt="Use a dremel to open a circular hole in the back. Make sure to use a screw driver to remove any excess plastic." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>Now that the hole is wide enough, route the AirPort antenna back through this new opening. Make sure not to cut the antenna cord on the metal shielding. </p>

<p><img src="/assets/threading-the-anteana_large.jpg" alt="Route the AirPort antenna back through this new opening. Make sure not to cut the antenna cord on the metal shielding." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>After you connect the AirPort antenna back to the AirPort extreme card, make sure that you leave the cable lying next to the slot the drive and fan assembly goes back into. </p>

<p><img src="/assets/external-mini-airport_large.jpg" alt="Make sure that you leave the cable lying next to the slot the drive and fan assembly goes back into." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>Here is a picture of the how the antenna cable routes through the small opening that is designed to the left drive and fan assembly slot. This is where Apple intended the AirPort antenna to go. We are just taking a detour. </p>

<p><img src="/assets/airport-wire_large.jpg" alt="A picture of the how the antenna cable routes through the small opening that is designed to the left drive and fan assembly slot." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>Now we are ready to put the cover back on the Mini, but since we have the AirPort antenna going out the security slot, we will need to cut the metal anchor off. I sliced it right at the bottom, marked in the larger photo. </p>

<p><img src="/assets/cutting-the-security_large.jpg" alt="Cut the metal anchor for the security slot off before putting the cover back on. Cut it flush with the Mini's casing." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>I have found it extremely useful to take your putty knife and push on the shielding on the back side of the Mini when you are snapping the cover back on. Otherwise you will just bend the clips when you are pushing it together. And just in case your asking, yes, a putty knife is the standard tool for taking apart a Mac Mini. </p>

<p><img src="/assets/putting-the-mini-together_large.jpg" alt="Put your putty knife into the back of the Mini to help you nudge the shielding inside the cover when you are snapping it back together." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>Here is a final picture of the back of the Minis after they are all back together. Here you can see the AirPort antennas sitting comfortably out the back. No signal interference now! </p>

<p><img src="/assets/final-mac-mini-w-airport_large.jpg" alt="Here you can see the AirPort antennas sitting out the back of each Mac Minis." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" />&lt;</p>

<p>This was the reason I started my network project. I have 3 servers right on my home office desk with all the comforts of a full fledged NOC in less than 1 square foot of space. </p>

<p><img src="/assets/final-mac-mini-stacks_large.jpg" alt="Final front view of 3 Mac Mini server right on my home office desk wiht all the comforts of a full fledged NOC in less than 1 square foot of space." class="ms-Img ms-Img--responsive-ctr ms-Img--fancy" /></p>

<p>That's it! If you have any questions, please let me know. Or perhaps, maybe you have some ideas on what I could work on for version two of the network?</p>

  <footer class="ms-Post-footer">
    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2006/02/05/mini-network-with-a-big-xserve-style/';
  var disqus_title = "Mini Network with a Big XServe Style";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  </footer>
</article>

    
    <footer class="ms-Footer">
  <p>
    &copy; 2006-2018 Ken Collins. All rights reserved.<br/>
    MetaSkills.net is powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://disqus.com">Disqus</a>.
  </p>
</footer>

  </article>
</section>

    <script src="/assets/site.js"></script>
  </body>
</html>
