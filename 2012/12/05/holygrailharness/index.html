<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ken Collins" />
  <meta name="google-site-verification" content="W3DG-CkoWHypH24OfrGmGbMezvhC6AyLql4jLI7hXhI" />
  <meta name="description" content="The personal blog of Ken Collins." />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cleartype" content="on">
  <title>HolyGrailHarness - Ken Collins @MetaSkills.net</title>
  <link rel="author" href="mailto:ken@metaskills.net" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/site/icon-57x57-2dc1878cbb26a72f6a2819a2959a45ce.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/site/icon-114x114-0f98048facce72f3ad247a009ea96f4a.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/site/icon-72x72-2744bec8e69ef81b753774e000caa98d.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/site/icon-60x60-07051b464dc0766991ee5ff852b094b6.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/site/icon-120x120-b042e116791abbbf98418647ac107fa1.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/site/icon-76x76-fe55f7ee2c9f030b64031197b06d42b7.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/site/icon-152x152-ba6a44bd01376645de8bd1ec76c06e04.png">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/site/icon-196x196-40d4187aec04946f3fc86d7c3103f603.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/site/icon-160x160-ce83115bd1f54907855b72c8ecdfe5dc.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/site/icon-96x96-7817af4c06b1cc48e5d14e8d061b0d0e.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/site/icon-16x16-5ca4ac15b854c68d6dd989fd7aeaf6c5.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/site/icon-32x32-d44229e428c67291a65f57aac0fc029d.png">
  <meta name="apple-mobile-web-app-title" content="MetaSkills">
  <meta name="application-name" content="MetaSkills" />
  <meta name="msapplication-TileImage" content="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <meta name="msapplication-TileColor" content="052838">
  <link rel="stylesheet" href="/assets/site-a864411acbd582736a5f389e093cc772.css">
</head>

  <body>
    <section class="ms-Page is-Post">
  <header class="ms-Page-header">
    <section class="ms-Page-header-bg">
      <object class="ms-Page-header-bg-svg" data="/assets/site/page-svg-d6ea380f6b530625d51eeeafaa44d925.svg" type="image/svg+xml"></object>
    </section>
    <section class="ms-Page-header-content">
      <div class="ms-Page-header-avatar">
<a class="ms-Avatar" href="/pages/colophon.html" title"About Ken Collins">
  <div class="ms-Avatar-flipable">
    <div class="ms-Avatar-front">
      <img class="ms-Avatar-img" alt="Ken Collins" src="/assets/site/avatar-87e53dd8cc99a37a2842f8918ea310e7.jpg">
    </div>
    <div class="ms-Avatar-back">
      <svg class="ms-Avatar-aboutme" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="350px" height="47px" viewBox="0 0 350 47" preserveAspectRatio="xMidYMax meet" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(1.000, 1.000)"><path d="M161.250 4.91 L-0.014 -0.12 L17.975 44.67 L178.787 37.22 L330.559 44.67 L347.824 -0.12 L161.250 4.91 Z" fill="#E4522A"/><g stroke="#FFFBE1"><path d="M275.89 25.53 L290.71 25.53 L287.55 20.31 L321.9 20.31 "/><path d="M276.55 22.54 L291.36 22.54 L288.2 17.33 L322.56 17.33 "/></g><g stroke="#FFFBE1"><path d="M72.76 25.53 L57.94 25.53 L61.1 20.31 L26.75 20.31 "/><path d="M72.1 22.54 L57.29 22.54 L60.45 17.33 L26.09 17.33 "/></g></g><path d="M89.184 15.23 L81.776 15.23 L81.724 15.52 C83.226 16.68 83.64 17.12 83.64 18.6 L83.641 31.76 L89.184 31.76 L89.184 27.43 L90.842 27.43 C91.955 27.43 92.19 28.05 92.19 29.04 L92.189 31.76 L97.732 31.76 L97.732 27.98 C97.732 24.92 96.9 24.04 93.64 24.04 L98.327 15.23 L92.189 15.23 L89.184 24.74 L89.184 15.23 Z M113.357 25.72 L113.357 21.99 L109.109 21.99 L109.109 19.14 L115.247 19.14 L115.247 15.23 L101.701 15.23 L101.649 15.52 C103.151 16.68 103.57 17.12 103.57 18.6 L103.566 31.76 L115.507 31.76 L115.507 28.03 L109.109 28.03 L109.109 25.72 L113.357 25.72 Z M119.346 15.23 L119.294 15.52 C120.797 16.68 121.21 17.12 121.21 18.6 L121.211 31.76 L126.754 31.76 L126.754 18.83 L129.008 18.83 C129.888 18.83 130.02 19.12 130.02 20 L130.018 31.76 L135.561 31.76 L135.561 19.84 C135.561 16.48 134.68 15.23 131.05 15.23 L119.346 15.23 Z M161.112 25.88 L161.112 26.92 C161.112 28.05 160.91 28.37 160.08 28.37 L159.014 28.37 C158.160 28.37 157.95 28.05 157.95 26.92 L157.952 20.26 C157.952 19.12 158.16 18.86 159.01 18.86 L160.076 18.86 C160.905 18.86 161.11 19.12 161.11 20.26 L161.112 23 L166.707 23 L166.707 20.05 C166.707 16.43 165.8 15.23 162.43 15.23 L156.631 15.23 C153.264 15.23 152.36 16.43 152.36 20.05 L152.357 26.53 C152.357 30.72 153.89 31.76 156.92 31.76 L162.433 31.76 C165.801 31.76 166.71 30.88 166.71 27.12 L166.707 25.88 L161.112 25.88 Z M186.606 20.05 C186.606 16.43 185.7 15.23 182.33 15.23 L176.375 15.23 C173.008 15.23 172.1 16.43 172.1 20.05 L172.101 26.53 C172.101 30.72 173.63 31.76 176.66 31.76 L182.332 31.76 C185.700 31.76 186.61 30.88 186.61 27.12 L186.606 20.05 Z M181.011 26.92 C181.011 28.05 180.8 28.37 179.97 28.37 L178.758 28.37 C177.903 28.37 177.7 28.05 177.7 26.92 L177.696 20.26 C177.696 19.12 177.9 18.86 178.76 18.86 L179.975 18.86 C180.804 18.86 181.01 19.12 181.01 20.26 L181.011 26.92 Z M198.216 15.23 L190.808 15.23 L190.757 15.52 C192.259 16.68 192.67 17.12 192.67 18.6 L192.673 31.76 L203.863 31.76 L203.863 28.03 L198.216 28.03 L198.216 15.23 Z M214.230 15.23 L206.822 15.23 L206.770 15.52 C208.272 16.68 208.69 17.12 208.69 18.6 L208.687 31.76 L219.877 31.76 L219.877 28.03 L214.230 28.03 L214.230 15.23 Z M230.244 15.23 L222.836 15.23 L222.784 15.52 C224.286 16.68 224.7 17.12 224.7 18.6 L224.700 31.76 L230.244 31.76 L230.244 15.23 Z M234.653 15.23 L234.601 15.52 C236.103 16.68 236.52 17.12 236.52 18.6 L236.518 31.76 L242.061 31.76 L242.061 18.83 L244.314 18.83 C245.195 18.83 245.32 19.12 245.32 20 L245.325 31.76 L250.868 31.76 L250.868 19.84 C250.868 16.48 249.99 15.23 246.36 15.23 L234.653 15.23 Z M268.410 15.23 L258.696 15.23 C256.805 15.23 256.13 16.06 256.13 17.36 C256.132 17.88 256.37 18.55 256.7 19.07 L261.753 27.07 C261.830 27.18 261.88 27.36 261.88 27.51 C261.882 27.82 261.65 28.03 261.18 28.03 L255.743 28.03 L255.743 31.76 L266.130 31.76 C268.073 31.76 268.8 30.49 268.8 29.45 C268.798 28.75 268.49 28.21 268.18 27.74 L262.970 20.13 C262.841 19.92 262.76 19.77 262.76 19.61 C262.763 19.33 263.02 19.14 263.49 19.14 L268.410 19.14 L268.410 15.23 Z" fill="#FFFBE1"/></g></svg>

    </div>
  </div>
</a>
</div>
      <ul class="ms-Page-nav">
        <li class="ms-Page-nav-item">
          <a class="ms-Page-nav-link" href="/">HOME</a>
        </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/programming.html">Programming</a>
          </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/lifestyle.html">Lifestyle</a>
          </li>
        
      </ul>
      <div class="ms-Page-social"><div class="ms-Social">
  <a href="http://twitter.com/metaskills" title="MetaSkills On Twitter">
    <span class="ms-Social-icon ms-Social-icon--twitter"><i class="icon-twitter"></i></span>
  </a>
  <a href="https://github.com/metaskills/" title="MetaSkills On GitHub">
    <span class="ms-Social-icon ms-Social-icon--github"><i class="icon-github"></i></span>
  </a>
  <a href="http://www.linkedin.com/in/metaskills" title="Ken Collins On LinkedIn">
    <span class="ms-Social-icon ms-Social-icon--linkedin"><i class="icon-linkedin"></i></span>
  </a>
</div>
</div>
      <div class="ms-Page-blurb">
        Ruby, JavaScript, Sass, iOS. Stinky Cheese &amp; Beer Advocate. Working at CustomInk and loving it!
      </div>
    </section>
  </header>
  <article class="ms-Page-article">
    <article class="ms-Post">
  <header class="ms-Post-header">
    <time class="ms-Post-time" pubdate datetime="2012-12-05T00:00:00-05:00">
      2012 December 05
    </time>
    <h1 class="ms-Post-header-h1">HolyGrailHarness</h1>
  </header>
  <p><aside class="ms-Flash">
  The latest README for HolyGrailHarness project will always be on the <a href="http://github.com/metaskills/holy_grail_harness">Github project</a> page.
</aside></p>

<p><img src="https://raw.github.com/metaskills/holy_grail_harness/master/app/assets/images/holy_grail_harness.png" class="ms-Img ms-Img--responsive"/></p>

<p>A curated Rails application prototype that focuses on simple test patterns for Ruby &amp; JavaScript!</p>

<p>Unlike normal <a href="http://guides.rubyonrails.org/rails_application_templates.html">Rails Application Templates</a> or more modern Rails application generators like <a href="http://railsapps.github.com/rails-composer/">Rails Composer</a>, the HolyGrailHarness is a basic Rails application that can be considered a prototype and customized via a simple setup script. It is also somewhat opinionated in that it promotes simple and powerful testing choices and focuses on using Ruby 1.9 and up, MiniTest::Spec, Capybara, Poltergeist/PhantomJS, and Konacha. More details on each component and what HolyGrailHarness provides are below.</p>

<p>The HolyGrailHarness is perfect for any of the following:</p>

<ul>
<li>Bootstrapping your next Rails application.</li>
<li>Learning and promoting MiniTest::Spec</li>
<li>Modern JavaScript testing setups.</li>
<li>Teaching Rails and/or JavaScript at your next meetup.</li>
</ul>

<h2 id="usage">Usage</h2>

<ul>
<li><a href="https://github.com/metaskills/holy_grail_harness/archive/master.zip">Download</a> the project.</li>
<li>Now from the root of &quot;holy_grail_harness&quot; directory.</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">puts</span> <span class="s2">"This code will be highlighted"</span>
</code></pre></div>
<p>Make sure to replace <code>my_app_name</code> above with the name of your new Rails application. The setup script has a few options, but the end result will be a new Rails application all ready to go. <strong>So why not a normal Rails application template?</strong> Although, Rails application templates provide a really nice feature set. It was much easier to bootstrap a new Rails application using this prototype method. The end result is a cleaner Gemfile and application setup that can be vetted and tested from within HolyGrailHarness itself.</p>

<p>The script will rename your directory and prompt you to <code>cd</code> to that directory. Once you do that, run <code>rake test:all</code> to see that everything is working.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span><span class="nb">cd</span> ../my_app_name
<span class="gp">$ </span>bundle <span class="nb">exec </span>rake <span class="nb">test</span>:all
</code></pre></div>
<h2 id="rails-3">Rails 3</h2>

<p>This application prototype will focus on the latest Rails version. At this time, the bundle is locked down to v3.2.9. As Rails updates and is compatible with each component, so will this prototype application be updated. The bundle includes:</p>

<ul>
<li><a href="https://github.com/evrone/quiet_assets">QuietAssets</a> gem for silent pipeline logging.</li>
<li><a href="https://github.com/macournoyer/thin/">Thin</a> webserver. Primarily to be automatically used by Konacha but also good for development if you are not using something like <a href="http://pow.cx">Pow</a>.</li>
</ul>

<h2 id="testing">Testing</h2>

<h3 id="minitest::spec-all-the-way-across-the-sky!">MiniTest::Spec All The Way Across The Sky!</h3>

<p>Don&#39;t wait for Rails 4 to use MiniTest::Spec! This application is using the <a href="https://github.com/metaskills/minitest-spec-rails">minitest-spec-rails</a> gem which forces <code>ActiveSupport::TestCase</code> to subclass <code>MiniTest::Spec</code>. This means that you can start using the MiniTest&#39;s Spec or Unit structure and assertions directly within the familiar Rails unit, functional, or integration directories. For full details, check out the <a href="https://github.com/metaskills/minitest-spec-rails">minitest-spec-rails</a> documentation or some of the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/test/functional/application_controller_test.rb">test shims</a> within HolyGrailHarness. For example, a <code>test/unit/user_test.rb</code> might look like this.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:bob</span><span class="p">)</span>   <span class="p">{</span> <span class="n">users</span><span class="p">(</span><span class="ss">:bob</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:admin</span><span class="p">)</span> <span class="p">{</span> <span class="n">users</span><span class="p">(</span><span class="ss">:admin</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'must respond true to #admin? for administrators only'</span> <span class="k">do</span>
    <span class="n">admin</span><span class="p">.</span><span class="nf">must_be</span> <span class="ss">:admin?</span>
    <span class="n">bob</span><span class="p">.</span><span class="nf">wont_be</span>   <span class="ss">:admin?</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<h3 id="capybara-integration-tests-with-poltergeist-using-phantomjs">Capybara Integration Tests With Poltergeist Using PhantomJS</h3>

<p>You don&#39;t need Cucumber to write good integration tests. Instead use the basic <a href="https://github.com/jnicklas/capybara#the-dsl">Capybara DSL</a> directly within a Rails integration tests with the most bad ass driver available, <a href="https://github.com/jonleighton/poltergeist">Poltergeist</a>, which is built on top of <a href="http://phantomjs.org">PhantomJS</a>. Never again worry about installing Qt so you can compile capybara-webkit, just go download a <a href="http://phantomjs.org/download.html">pre-compiled PhantomJS binary</a> for your specific platform and enjoy 20% faster integration test runs vs capybara-webkit.</p>

<p>Integration tests are still within the <code>ActionDispatch::IntegrationTest</code> class and as promised, MiniTest::Spec is available here too. Each test file needs to require the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/test/test_helper_integration.rb">test_helper_integration</a> which provides the following base features.</p>

<ul>
<li>Sets page size to that of a 13&quot; MacBook Air.</li>
<li>Resets Capybara sessions after each test.</li>
<li>Provides a <code>#save_and_open_page</code>, or <code>#page!</code> for short, screen shot method.</li>
<li>Ensures a single ActiveRecord DB connection for transactional test runs.</li>
<li>An <code>#execjs</code> helper for bridging Ruby and the JavaScript under test.</li>
</ul>

<p>HolyGrailHarness comes with a integration test example in the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/test/integration/application_test.rb">test/integration/application_test.rb</a> file. An integration test might look something like this.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'test_helper_integration'</span>

<span class="k">class</span> <span class="nc">ApplicationTest</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">IntegrationTest</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">visit</span> <span class="n">root_path</span> <span class="p">}</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:h1</span><span class="p">)</span> <span class="p">{</span> <span class="n">find</span> <span class="s1">'h1'</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'renders'</span> <span class="k">do</span>
    <span class="n">h1</span><span class="p">.</span><span class="nf">must_be</span> <span class="ss">:present?</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<h3 id="konacha-javascript-tests-using-phantomjs">Konacha JavaScript Tests Using PhantomJS</h3>

<p>Move over Jasmine(rice), <a href="https://github.com/jfirebaugh/konacha">Konacha</a> is the way to test your JavaScript now. Konacha is a Rails engine that allows you to test your JavaScript with the <a href="http://visionmedia.github.com/mocha/">Mocha</a> test framework and <a href="http://chaijs.com">Chai</a> assertion library. Konacha&#39;s killer feature is a sandboxed <code>&lt;iframe&gt;</code> for each test spec to run within as well as full Rails asset pipeline integration. The HolyGrailHarness does all the work to get your Konacha <a href="https://github.com/metaskills/holy_grail_harness/tree/master/spec/javascripts"><code>spec/javascripts</code></a> directory all setup and ready to go. Highlights include:</p>

<ul>
<li>An <a href="https://github.com/metaskills/holy_grail_harness/blob/master/config/initializers/konacha.rb">initializer</a> that sets up Poltergeist as the Capybara driver.</li>
<li>A directory structure for model, view, and controller specs.</li>
<li>A <a href="https://github.com/metaskills/holy_grail_harness/blob/master/spec/javascripts/spec_helper.js.coffee"><code>spec_helper.js.coffee</code></a> for your specs to require. Provides global setup, configurations and vendor requires.</li>
</ul>

<p>HolyGrailHarness also has a <a href="https://github.com/metaskills/holy_grail_harness/tree/master/spec/javascripts/spec_helper"><code>spec/javascripts/spec_helper</code></a> directory meant for helpers and extensions that should be available to all specs. We have included a <a href="https://github.com/metaskills/holy_grail_harness/blob/master/spec/javascripts/spec_helper/fixtures.js.coffee"><code>fixtures.js.coffee</code></a> file that demonstrates how to setup JSON data fixtures for use from anything to stubbing requests to instantiating new model objects. We also have a <a href="https://github.com/metaskills/holy_grail_harness/blob/master/spec/javascripts/spec_helper/helpers.js.coffee"><code>helpers.js.coffee</code></a> file that exposes a few top level functions that make debugging your JavaScript easy. Below are the vendored JavaScript libraries that are required by the <code>spec_helper</code>.</p>

<ul>
<li><a href="http://sinonjs.org">Sinon.JS</a> - For spies, stubs, faking time, etc.</li>
<li><a href="https://github.com/appendto/jquery-mockjax">jQuery Mockjax</a> - Best way to mock jQuery&#39;s AJAX functions.</li>
<li><a href="https://github.com/chaijs/chai-jquery">Chai jQuery</a> - Chai assertions for jQuery.</li>
<li><a href="http://github.com/NV/jsDump">jsDump</a> - Used by the <code>myLog()</code> helper.</li>
</ul>

<p>Because your CI system should run all your tests, the HolyGrailHarness has added a Rake task to the test namespace that runs the default rails test task (units, functional, integrations) then your Konacha tests.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>rake <span class="nb">test</span>:all     <span class="c"># Runs all Rails tests, then Konacha tests.</span>
</code></pre></div>
<h3 id="guard">Guard</h3>

<p>TDD in style and run your tests when you hit save! Both <a href="https://github.com/guard/guard-minitest">guard-minitest</a> and <a href="https://github.com/alexgb/guard-konacha">guard-konacha</a> are bundled and ready to go. A basic <code>Guardfile</code> is already setup too. Unlike most, this one is split into two groups <code>:ruby</code> or <code>:js</code>. This lets you focus on either everything or a specific language for your tests.</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>guard             <span class="c"># Monitor both Ruby and JavaScript tests.</span>
<span class="gp">$ </span>guard -g ruby     <span class="c"># Monitor Ruby tests.</span>
<span class="gp">$ </span>guard -g js       <span class="c"># Monitor JavaScript tests.</span>
</code></pre></div>
<p>The Guardfile assumes you are running OS X and wish to use the Ruby GNTP (Growl Notification Transport Protocol). If this is not the case, consult the Guard documentation on different <a href="https://github.com/guard/guard#system-notifications">system notification</a> alternatives.</p>

<h3 id="factories-and-fixtures">Factories And Fixtures</h3>

<p>ActiveRecord YAML fixtures suck, but so do slow tests that rely on an empty database with excessive setups based on factories. The answer? Take advantage of the best each has to offer. Use factories to populate fixtures into the test database while leveraging database transactions during your test runs. The end result is a known factory story with the ability to create more test data as needed using the same factories. Allowing factories to properly hook into model logic means no more decomposing business logic into YAML text files. How?</p>

<p>The HolyGrailHarness bundles the <a href="https://github.com/metaskills/named_seeds">named_seeds</a> gem along with the <a href="https://github.com/thoughtbot/factory_girl">factory_girl</a> gem. The NamedSeeds library checks for the existence of a <a href="https://github.com/metaskills/holy_grail_harness/blob/master/db/test/seeds.rb"><code>db/test/seeds.rb</code></a> file and if present, loads that file. Just like Rails&#39; own <code>db/seeds.rb</code> anything in this file goes. The only difference is that this seed file is populated right before you tests are run so they persist between transactions. You also get the benefit of using this same seed data in development as part of the normal Rails <code>db:setup</code> process. Read the <a href="https://github.com/metaskills/named_seeds#namedseeds">full documentationn</a> on their site on how to use it. Below is a brief example.</p>

<p>Create factories in the <code>test/factories</code> directory. Note, factories are best when they make <code>valid garbage™</code>, so the HolyGrailHarness also requires the <a href="https://github.com/sevenwire/forgery">forgery</a> gem to help with that.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># In test/factories/user_factory.rb</span>

<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">define</span> <span class="k">do</span>

  <span class="n">factory</span> <span class="ss">:user</span> <span class="k">do</span>
    <span class="n">email</span>      <span class="p">{</span> <span class="no">Forgery</span><span class="o">::</span><span class="no">Email</span><span class="p">.</span><span class="nf">address</span> <span class="p">}</span>
    <span class="n">first_name</span> <span class="p">{</span> <span class="no">Forgery</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">first_name</span> <span class="p">}</span>
    <span class="n">last_name</span>  <span class="p">{</span> <span class="no">Forgery</span><span class="o">::</span><span class="no">Name</span><span class="p">.</span><span class="nf">first_name</span> <span class="p">}</span>
    <span class="n">password</span>   <span class="s1">'test'</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<p>When making seed data, be explicit with your attributes that may be forged in the factory, database seeds should be consistent and have meaningful attributes. In this example we are creating an admin user. Note too how we are using <code>NamedSeeds.identify</code> which mimics AcctiveRecord&#39;s fixture identity. This gives us a handle to the fixture within our tests. We also create the <code>@admin</code> instance variable because we might want to use that user later on in the fixture story.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># In db/test/seeds.rb</span>

<span class="nb">require</span> <span class="s1">'factory_girl'</span>
<span class="no">FactoryGirl</span><span class="p">.</span><span class="nf">find_definitions</span> <span class="k">rescue</span> <span class="kp">true</span>
<span class="kp">include</span> <span class="no">FactoryGirl</span><span class="o">::</span><span class="no">Syntax</span><span class="o">::</span><span class="no">Methods</span>

<span class="vi">@admin</span> <span class="o">=</span> <span class="n">create</span> <span class="ss">:user</span><span class="p">,</span> <span class="ss">id: </span><span class="no">NamedSeeds</span><span class="p">.</span><span class="nf">identify</span><span class="p">(</span><span class="ss">:admin</span><span class="p">),</span>
                       <span class="ss">first_name: </span><span class="s1">'Admin'</span><span class="p">,</span> <span class="ss">last_name: </span><span class="s1">'User'</span><span class="p">,</span> <span class="ss">email: </span><span class="s1">'admin@test.com'</span>
</code></pre></div>
<p>Lastly, in your <a href="https://github.com/metaskills/holy_grail_harness/blob/master/test/test_helper.rb"><code>test/test_helper.rb</code></a> file, declare that you have a named seed to the users model. This will allow your tests to act just like those with ActiveRecord fixtures and use the <code>users(:admin)</code> helper to get to that seeded fixture.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># In test/test_helper.rb</span>

<span class="k">class</span> <span class="nc">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="n">named_seeds</span> <span class="ss">:users</span>

<span class="k">end</span>
</code></pre></div>
<h2 id="mvc-javascript">MVC JavaScript</h2>

<p>The HolyGrailHarness wants you to use some type MV* structure for your JavaScript. The setup script supports <a href="http://spinejs.com">Spine.js</a> as an option, however you can decline and all traces of Spine.js will be removed. If so, the following features will still remain.</p>

<p>A single JavaScript <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/javascripts/holy_grail_harness/lib/namespaces.js.coffee">namespace</a> on the window object. This namespace creates a model, view, controller object structure that direly matches to the <a href="https://github.com/metaskills/holy_grail_harness/tree/master/app/assets/javascripts/holy_grail_harness"><code>app/assets/javascripts/#{my_app_name}/(model|view|controller)</code></a> directory structure within the Rails asset pipeline. This JavaScript namespace and matching directories will be changed to your new application name as part of the setup task. Here is an example of a User model whose corresponding file would be found in the <code>app/assets/javascripts/my_app_name/models/user.js.coffee</code> file.</p>
<div class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="k">class</span> <span class="vi">@</span><span class="na">MyAppName</span><span class="p">.</span><span class="na">App</span><span class="p">.</span><span class="na">Models</span><span class="p">.</span><span class="na">User</span> <span class="k">extends</span> <span class="nx">View</span>
  <span class="vi">@</span><span class="na">configure</span> <span class="s">'User'</span><span class="p">,</span> <span class="s">'id'</span><span class="p">,</span> <span class="s">'email'</span>
</code></pre></div>
<p>The main <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/javascripts/application.js"><code>application.js</code></a> file requires all vendor frameworks, then the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/javascripts/holy_grail_harness/index.js.coffee"><code>index.js.coffee</code></a> within your application name directory. Use this file to boot your JavaScript application and/or setup your root view controller.</p>

<p>Also included is the <a href="https://github.com/nathansobo/space-pen">SpacePen</a> view framework. SpacePen is a powerful and minimalist client-side view framework authored in CoffeeScript. It is actually a jQuery subclass which makes your views really easy to traverse and respond to controller events. Read my <a href="http://metaskills.net/2012/05/22/view-controller-patterns-with-spine-js-and-spacepen/"><em>View Controller Patterns With Spine.js &amp; SpacePen</em></a> article to learn why views should not be dumb and how you can take advantage of SpacePen no matter what JavaScript MV* framework you use.</p>

<h3 id="with-spine.js">With Spine.js</h3>

<p>If you choose to use Spine.js as your JavaScript MVC structure, the setup script will create a git submodule to the Spine repository to the <code>vendor/assets/javascripts/spine</code> directory. This allows your project to use the the source CoffeeScript files, which makes for a wonderful <a href="http://metaskills.net/2012/01/15/rails-and-spine-js-using-the-coffeescript-source/">learning experience</a> to both Spine.js and idomatic CoffeeScript.</p>

<p>By default the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/javascripts/holy_grail_harness/index.js.coffee"><code>index.js.coffee</code></a> will require all Spine components. This includes manager (stacks), ajax, route, and relation. Remove anything that you do not need. This file also defines the root view controller along with a <code>MyAppName.App.Index.init()</code> class level initialization function. This is called in the main <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/views/layouts/application.html.erb"><code>application.html.erb</code></a> layout file for you too. Likewise, the application init is done in the Mocha before filters mentioned above in both the <a href="https://github.com/metaskills/holy_grail_harness/blob/master/spec/javascripts/spec_helper.js.coffee"><code>spec_helper.js.coffee</code></a> and <a href="https://github.com/metaskills/holy_grail_harness/blob/master/spec/javascripts/spec_helper/fixtures.js.coffee"><code>fixtures.js.coffee</code></a> files. If you examine these files closely, you will see how they make use of Mocha&#39;s <code>done()</code> callback so that you can cleanly abstract AJAX mocks and anything else related to your JavaScript application&#39;s boot process. Here is an example of how you might setup your <code>initApplication()</code>.</p>
<div class="highlight"><pre><code class="language-coffeescript" data-lang="coffeescript"><span class="vi">@</span><span class="na">initApplication</span> <span class="o">=</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nx">bob</span> <span class="o">=</span> <span class="nx">MyAppName</span><span class="p">.</span><span class="na">Test</span><span class="p">.</span><span class="na">Seeds</span><span class="p">.</span><span class="na">users</span><span class="p">.</span><span class="na">bob</span>
  <span class="nx">$</span><span class="p">.</span><span class="na">mockjax</span> <span class="na">url</span><span class="o">:</span> <span class="s">"/users/</span><span class="si">#{</span><span class="nx">bob</span><span class="p">.</span><span class="na">id</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="na">responseText</span><span class="o">:</span> <span class="nx">MyAppName</span><span class="p">.</span><span class="na">Test</span><span class="p">.</span><span class="na">Response</span><span class="p">.</span><span class="na">bobInitial</span><span class="p">.</span><span class="na">responseText</span>
  <span class="nx">MyAppName</span><span class="p">.</span><span class="na">App</span><span class="p">.</span><span class="na">Models</span><span class="p">.</span><span class="na">User</span><span class="p">.</span><span class="na">fetch</span> <span class="na">id</span><span class="o">:</span> <span class="nx">bob</span><span class="p">.</span><span class="na">id</span>
  <span class="nx">MyAppName</span><span class="p">.</span><span class="na">App</span><span class="p">.</span><span class="na">Models</span><span class="p">.</span><span class="na">User</span><span class="p">.</span><span class="na">one</span> <span class="s">'refresh'</span><span class="p">,</span> <span class="nx">callback</span>
</code></pre></div>
<p>No JavaScript project should be without a local notification system to help keep disparate components up to date. Thankfully, Spine&#39;s event module makes a local PubSub system a breeze. The HolyGrailHarness has a <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/javascripts/holy_grail_harness/lib/notifications.js.coffee"><code>notifications.js.coffee</code></a> that exposes a class level <code>bind()</code> and <code>trigger()</code> to any event string/namespace you want. To make more simple, we recommend creating class level functions that expose the event name as the function name and pass the args to the <code>handle()</code> function. We have done this for the <code>MyAppName.Notifications.appReady()</code> to demonstrate. Calling this function will trigger the <code>app.ready</code> event and passing a function to this function will bind that function to the same event name.</p>

<h2 id="sass-&amp;-compass">Sass &amp; Compass</h2>

<p><a href="http://sass-lang.com">Sass</a> is the only way to write CSS for today&#39;s modern web applications. <a href="http://compass-style.org">Compass</a> is the CSS framework that no Sass user should go without. Together they provide a foundation for writing beautiful CSS using pre-built time saving functions. The HolyGrailHarness includes both the <a href="https://github.com/rails/sass-rails">sass-rails</a> and <a href="https://github.com/Compass/compass-rails">compass-rails</a> gems.</p>

<p>To get you started on the right path, we have also created a basic structure within the <code>app/assets/stylesheets</code> asset pipeline directory to help you organize your Sass files. Here is the directory structure below.</p>
<div class="highlight"><pre><code class="language-" data-lang="">├── application.css
├── application
│   ├── _layout.scss
│   ├── index.scss
│   ├── components
│   │   └── _foo.scss
└── shared
    ├── _animations.scss
    ├── _fonts.scss
    ├── _mixins.scss
    ├── _placeholders.scss
    ├── _variables.scss
    └── base.scss
</code></pre></div>
<h3 id="the-application.css-file.">The application.css file.</h3>

<p>Never write CSS in <code>application.css</code>. Say what? I know right, but trust me. Just consider this file a top level bundle dependency that only requires other top level bundle assets. Here is the contents of that file. Notice how it requires a bundle called twitter and an index. One is for twitter bootstrap, see section below, and the other is the index to your own Sass framework.</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="c">/*
 *= require application/twitter
 *= require application/index
*/</span>
</code></pre></div>
<h3 id="the-shared-directory.">The shared directory.</h3>

<p>Think of this as your own Compass framework. The <a href="https://github.com/metaskills/holy_grail_harness/blob/master/app/assets/stylesheets/shared/base.scss"><code>base.scss</code></a> is your single file to <code>@import</code> to get everything loaded and ready to go. <strong>Nothing in any of the shared files should generate CSS!</strong> Importing <code>shared/base</code> should act just like importing <code>compass</code>. Use these files for setting your own variables and creating misc helper functions &amp; mixins. There is a variables file for... variables! Another for animations, fonts and mixins too.</p>

<p>Pay special attention to the <code>_placeholders.scss</code> file. If you do not know about Sass 3.2&#39;s placeholder selectors (silent classes) and how they make presentational classes efficiently extended by semantic ones, then I highly suggest you read Dale Sande&#39;s presentation titled <a href="https://speakerdeck.com/anotheruiguy/sass-32-silent-classes">Sass 3.2 Silent Classes</a> on Speaker Deck.</p>

<p>Below is the contents of the <code>base.scss</code> file, take note of the order. See too how we import the entire Compass framework. This means that all of your Sass code in any of the shared files can take full advantage of both Bootstrap and Compass&#39; variables and mixins. Epic win!</p>
<div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="c1">// Think of this file as your own compass. Importing the base, never generates CSS.
</span>
<span class="k">@import</span> <span class="s">"shared/variables";</span>
<span class="k">@import</span> <span class="s">"bootstrap/mixins";</span>
<span class="k">@import</span> <span class="s">"compass";</span>
<span class="k">@import</span> <span class="s">"compass/layout";</span>
<span class="k">@import</span> <span class="s">"compass/css3/user-interface";</span>
<span class="k">@import</span> <span class="s">"shared/fonts";</span>
<span class="k">@import</span> <span class="s">"shared/mixins";</span>
<span class="k">@import</span> <span class="s">"shared/animations";</span>
<span class="k">@import</span> <span class="s">"shared/placeholders";</span>
</code></pre></div>
<h3 id="the-application-directory.">The application directory.</h3>

<p>Organize this as you see fit. We have started you off by creating a <code>_layout.scss</code> file for your general layout/structure styles. There is also a <code>components</code> directory which all sub files are imported via a glob. The idea is that components are not dependent upon another. Files that might go in here are things like datepicker, navigation, and general files named after components or widgets. Below is what the <code>application/index.scss</code> looks like.</p>
<div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="k">@import</span> <span class="s">"shared/base";</span>
<span class="k">@import</span> <span class="s">"./layout";</span>
<span class="k">@import</span> <span class="s">"components/*";</span>
</code></pre></div>
<p>If you are more advanced with your CSS and like the idea of style guides, take a looks a the <a href="https://github.com/Anotheruiguy/toadstool">Toadstool</a> style guide framework.</p>

<h2 id="twitter-bootstrap">Twitter Bootstrap</h2>

<p><a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a> is awesome, but <a href="http://metaskills.net/2012/02/27/too-less-should-you-be-using-sass/">LESS is not</a>. That is why the HolyGrailHarness uses the <a href="https://github.com/thomas-mcdonald/bootstrap-sass">bootstrap-sass</a> gem that converts all the Bootstrap LESS files to Sass. Making them ready to import via the Rails asset pipeline.</p>

<p>As shown above in the Sass section, we require the <code>application/twitter.scss</code> bundle asset from the top level <code>application.css</code> bundle file. This twitter bundle file, contents below, take advantage of your shared variables before importing bootstrap from the gem. In this way you can define variables that tweak bootstrap. A good example would be button colors, column widths, etc. Later on in the file you can extend bootstrap styles to your liking. For instance, add more padding to buttons.</p>
<div class="highlight"><pre><code class="language-sass" data-lang="sass"><span class="k">@import</span> <span class="s">"shared/variables";</span>
<span class="k">@import</span> <span class="s">"bootstrap";</span>
<span class="k">@import</span> <span class="s">"font-awesome";</span>

<span class="c1">// Tweak or redefine Twitter classes below.
</span></code></pre></div>
<h3 id="font-awesome">Font Awesome</h3>

<p>The glyph icons included in Twitter Bootstrap are horrible for hi-resolution &quot;retina&quot; displays typically found on mobile devices. Thankfully the <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a> project provides a drop in replacement that instead uses icon fonts vs raster images.</p>

<p>The HolyGrailHarness vendors these font files and the needed <code>font-awesome.scss</code> file and requires them as part of the Twitter Bootstrap bundle shown above. More advanced users may prefer to only include the icon fonts needed in their application or a few custom icons. If that is the case, check out <a href="http://endtwist.github.com/fontcustom/">Font Custom</a>, webfonts from the comfort of the command line.</p>

  <footer class="ms-Post-footer">
    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2012/12/05/holygrailharness';
  var disqus_title = "HolyGrailHarness";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  </footer>
</article>

    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2012/12/05/holygrailharness';
  var disqus_title = "HolyGrailHarness";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


    <footer class="ms-Footer">
  <p>
    &copy; 2006-2014 Ken Collins. All rights reserved.<br/>
    MetaSkills.net is powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://disqus.com">Disqus</a>.
  </p>
</footer>

  </article>
</section>

    <script src="/assets/site-5b742dd84d08dc11c2e75947ba53428e.js"></script>
  </body>
</html>
