<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ken Collins" />
  <meta name="google-site-verification" content="W3DG-CkoWHypH24OfrGmGbMezvhC6AyLql4jLI7hXhI" />
  <meta name="description" content="The personal blog of Ken Collins." />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cleartype" content="on">
  <title>The "AJAX Head" Design Pattern - Ken Collins @MetaSkills.net</title>
  <link rel="author" href="mailto:ken@metaskills.net" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/site/icon-57x57-2dc1878cbb26a72f6a2819a2959a45ce.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/site/icon-114x114-0f98048facce72f3ad247a009ea96f4a.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/site/icon-72x72-2744bec8e69ef81b753774e000caa98d.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/site/icon-60x60-07051b464dc0766991ee5ff852b094b6.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/site/icon-120x120-b042e116791abbbf98418647ac107fa1.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/site/icon-76x76-fe55f7ee2c9f030b64031197b06d42b7.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/site/icon-152x152-ba6a44bd01376645de8bd1ec76c06e04.png">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/site/icon-196x196-40d4187aec04946f3fc86d7c3103f603.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/site/icon-160x160-ce83115bd1f54907855b72c8ecdfe5dc.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/site/icon-96x96-7817af4c06b1cc48e5d14e8d061b0d0e.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/site/icon-16x16-5ca4ac15b854c68d6dd989fd7aeaf6c5.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/site/icon-32x32-d44229e428c67291a65f57aac0fc029d.png">
  <meta name="apple-mobile-web-app-title" content="MetaSkills">
  <meta name="application-name" content="MetaSkills" />
  <meta name="msapplication-TileImage" content="/assets/site/icon-144x144-0017fda127bc7319e5a20ece8baf1dc7.png">
  <meta name="msapplication-TileColor" content="052838">
  <link rel="stylesheet" href="/assets/site-cbdf9278b784acb822fb003522388a7f.css">
</head>

  <body>
    <section class="ms-Page is-Post">
  <header class="ms-Page-header">
    <section class="ms-Page-header-bg">
      <object class="ms-Page-header-bg-svg" data="/assets/site/page-svg-d6ea380f6b530625d51eeeafaa44d925.svg" type="image/svg+xml"></object>
    </section>
    <section class="ms-Page-header-content">
      <div class="ms-Page-header-avatar">
<a class="ms-Avatar" href="/pages/colophon.html" title"About Ken Collins">
  <div class="ms-Avatar-flipable">
    <div class="ms-Avatar-front">
      <img class="ms-Avatar-img" alt="Ken Collins" src="/assets/site/avatar-87e53dd8cc99a37a2842f8918ea310e7.jpg">
    </div>
    <div class="ms-Avatar-back">
      <svg class="ms-Avatar-aboutme" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="350px" height="47px" viewBox="0 0 350 47" preserveAspectRatio="xMidYMax meet" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(1.000, 1.000)"><path d="M161.250 4.91 L-0.014 -0.12 L17.975 44.67 L178.787 37.22 L330.559 44.67 L347.824 -0.12 L161.250 4.91 Z" fill="#E4522A"/><g stroke="#FFFBE1"><path d="M275.89 25.53 L290.71 25.53 L287.55 20.31 L321.9 20.31 "/><path d="M276.55 22.54 L291.36 22.54 L288.2 17.33 L322.56 17.33 "/></g><g stroke="#FFFBE1"><path d="M72.76 25.53 L57.94 25.53 L61.1 20.31 L26.75 20.31 "/><path d="M72.1 22.54 L57.29 22.54 L60.45 17.33 L26.09 17.33 "/></g></g><path d="M89.184 15.23 L81.776 15.23 L81.724 15.52 C83.226 16.68 83.64 17.12 83.64 18.6 L83.641 31.76 L89.184 31.76 L89.184 27.43 L90.842 27.43 C91.955 27.43 92.19 28.05 92.19 29.04 L92.189 31.76 L97.732 31.76 L97.732 27.98 C97.732 24.92 96.9 24.04 93.64 24.04 L98.327 15.23 L92.189 15.23 L89.184 24.74 L89.184 15.23 Z M113.357 25.72 L113.357 21.99 L109.109 21.99 L109.109 19.14 L115.247 19.14 L115.247 15.23 L101.701 15.23 L101.649 15.52 C103.151 16.68 103.57 17.12 103.57 18.6 L103.566 31.76 L115.507 31.76 L115.507 28.03 L109.109 28.03 L109.109 25.72 L113.357 25.72 Z M119.346 15.23 L119.294 15.52 C120.797 16.68 121.21 17.12 121.21 18.6 L121.211 31.76 L126.754 31.76 L126.754 18.83 L129.008 18.83 C129.888 18.83 130.02 19.12 130.02 20 L130.018 31.76 L135.561 31.76 L135.561 19.84 C135.561 16.48 134.68 15.23 131.05 15.23 L119.346 15.23 Z M161.112 25.88 L161.112 26.92 C161.112 28.05 160.91 28.37 160.08 28.37 L159.014 28.37 C158.160 28.37 157.95 28.05 157.95 26.92 L157.952 20.26 C157.952 19.12 158.16 18.86 159.01 18.86 L160.076 18.86 C160.905 18.86 161.11 19.12 161.11 20.26 L161.112 23 L166.707 23 L166.707 20.05 C166.707 16.43 165.8 15.23 162.43 15.23 L156.631 15.23 C153.264 15.23 152.36 16.43 152.36 20.05 L152.357 26.53 C152.357 30.72 153.89 31.76 156.92 31.76 L162.433 31.76 C165.801 31.76 166.71 30.88 166.71 27.12 L166.707 25.88 L161.112 25.88 Z M186.606 20.05 C186.606 16.43 185.7 15.23 182.33 15.23 L176.375 15.23 C173.008 15.23 172.1 16.43 172.1 20.05 L172.101 26.53 C172.101 30.72 173.63 31.76 176.66 31.76 L182.332 31.76 C185.700 31.76 186.61 30.88 186.61 27.12 L186.606 20.05 Z M181.011 26.92 C181.011 28.05 180.8 28.37 179.97 28.37 L178.758 28.37 C177.903 28.37 177.7 28.05 177.7 26.92 L177.696 20.26 C177.696 19.12 177.9 18.86 178.76 18.86 L179.975 18.86 C180.804 18.86 181.01 19.12 181.01 20.26 L181.011 26.92 Z M198.216 15.23 L190.808 15.23 L190.757 15.52 C192.259 16.68 192.67 17.12 192.67 18.6 L192.673 31.76 L203.863 31.76 L203.863 28.03 L198.216 28.03 L198.216 15.23 Z M214.230 15.23 L206.822 15.23 L206.770 15.52 C208.272 16.68 208.69 17.12 208.69 18.6 L208.687 31.76 L219.877 31.76 L219.877 28.03 L214.230 28.03 L214.230 15.23 Z M230.244 15.23 L222.836 15.23 L222.784 15.52 C224.286 16.68 224.7 17.12 224.7 18.6 L224.700 31.76 L230.244 31.76 L230.244 15.23 Z M234.653 15.23 L234.601 15.52 C236.103 16.68 236.52 17.12 236.52 18.6 L236.518 31.76 L242.061 31.76 L242.061 18.83 L244.314 18.83 C245.195 18.83 245.32 19.12 245.32 20 L245.325 31.76 L250.868 31.76 L250.868 19.84 C250.868 16.48 249.99 15.23 246.36 15.23 L234.653 15.23 Z M268.410 15.23 L258.696 15.23 C256.805 15.23 256.13 16.06 256.13 17.36 C256.132 17.88 256.37 18.55 256.7 19.07 L261.753 27.07 C261.830 27.18 261.88 27.36 261.88 27.51 C261.882 27.82 261.65 28.03 261.18 28.03 L255.743 28.03 L255.743 31.76 L266.130 31.76 C268.073 31.76 268.8 30.49 268.8 29.45 C268.798 28.75 268.49 28.21 268.18 27.74 L262.970 20.13 C262.841 19.92 262.76 19.77 262.76 19.61 C262.763 19.33 263.02 19.14 263.49 19.14 L268.410 19.14 L268.410 15.23 Z" fill="#FFFBE1"/></g></svg>

    </div>
  </div>
</a>
</div>
      <ul class="ms-Page-nav">
        <li class="ms-Page-nav-item">
          <a class="ms-Page-nav-link" href="/">HOME</a>
        </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/programming.html">Programming</a>
          </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/lifestyle.html">Lifestyle</a>
          </li>
        
      </ul>
      <div class="ms-Page-social"><div class="ms-Social">
  <a href="http://twitter.com/metaskills" title="MetaSkills On Twitter">
    <span class="ms-Social-icon ms-Social-icon--twitter"><i class="icon-twitter"></i></span>
  </a>
  <a href="https://github.com/metaskills/" title="MetaSkills On GitHub">
    <span class="ms-Social-icon ms-Social-icon--github"><i class="icon-github"></i></span>
  </a>
  <a href="http://www.linkedin.com/in/metaskills" title="Ken Collins On LinkedIn">
    <span class="ms-Social-icon ms-Social-icon--linkedin"><i class="icon-linkedin"></i></span>
  </a>
</div>
</div>
      <div class="ms-Page-blurb">
        Ruby, JavaScript, Sass, iOS. Stinky Cheese &amp; Beer Advocate. Working at CustomInk and loving it!
      </div>
    </section>
  </header>
  <article class="ms-Page-article">
    <article class="ms-Post">
  <header class="ms-Post-header">
    <time class="ms-Post-time" pubdate datetime="2008-05-24T00:00:00-04:00">
      2008 May 24
    </time>
    <h1 class="ms-Post-header-h1">The "AJAX Head" Design Pattern</h1>
  </header>
  <p><aside class="ms-Flash">
  Chris Williams did a really great write up on this pattern with great details on when/how to use it. Please considering <a href="http://voodootikigod.com/ajax-head-design-pattern">reading it</a> afterward.
</aside></p>

<p>
  This is the first of a few articles covering the total rewrite of the <a href="http://homemarks.com/">HomeMarks.com</a> code base as I upgrade it to Rails 2.1. The "AJAX Head" pattern is the moniker I have assigned to methodology that has come about during said rewrite and the design decisions I choose early on. The rules were simple.
</p>

<ul>
  <li>Total Unobtrusive JavaScript (<a href="http://en.wikipedia.org/wiki/Tag_soup">No Tag Soup</a>)</li>
  <li>No RJS Controller Responses</li>
</ul>

<p>
  Rails makes it very easy to generate JavaScript with Ruby. The generator methods are extensive and cover both the Prototype and Scriptaculous libraries. The first version of HomeMarks used the generators exclusively to augment both the views and controller responses. In fact, I used a technique that is covered in the latest <a href="http://www.pragprog.com/titles/fr_arr/advanced-rails-recipes"><em>Advanced Rails Recipes</em></a> (way before it came out) under the "Replace In-View Raw JavaScript" chapter. Basically I created helper methods that generated JavaScript shared by both the views and controllers. It was a great technique but things <a href="http://github.com/metaskills/homemarks/tree/d33dab1405537db2d2dab86d79db415d9e7f56e5/app/helpers/application_helper.rb">got messy quick</a>. So life was good back then, I had a lot of Ruby code and a very dynamic site, but something did not seem right...
</p>

<h2>What Is The AJAX Head Pattern?</h2>

<p>
  It is an experiment into a vision to see what happens when you make the decision to totally go unobtrusive. Not just in your views but the controllers too! Imagine it this way &mdash; your controllers are <strong>slim APIs</strong>. They should do nothing but render a page on a GET request and when it comes to a POST/PUT/DELETE they should do nothing more than just say YES or NO (with errors).
</p>

<p>
  Now lets think about that. What does that mean for an application that uses exclusive AJAX calls for dynamic page updates? It means that your visual client (the browser) will need to know ALOT less from the controller about what to do. It's great, the browser knows what is on the page, from the GET request, and what it needs to do with it. The client only needs to tell the remote resource store what it did. In this pattern the controller is relegated to nothing more than acting on model data and letting the client know if it succeeded or failed. So in short.
</p>

<blockquote>
  The AJAX head design pattern forces the view and controller to work in isolation with the most minimal coupling possible. Kind of like a web service.
</blockquote>

<h2>Tools and Code Needed</h2>

<ul>
  <li>A application that does just about everything with AJAX.</li>
  <li>Fluency with ActionController::Base#head method and HTTP status codes.</li>
  <li>Site-wide exception rescues for ActiveRecord::RecordInvalid.</li>
  <li>Global client-side AJAX request and response handlers.</li>
  <li>Global client-side error handlers.</li>
</ul>

<p>
  This may seem like a daunting list, but its pretty simple when you break it down. Let's do each one at at time with some of the current code from HomeMarks. The HomeMarks app is my first check on the list. When I did this app just about EVERYTHING was done via an AJAX call to update the page. Now on to the others.
</p>

<h2>Head And Status Codes</h2>

<p>
  The <a href="http://api.rubyonrails.com/classes/ActionController/Base.html#M000454">ActionController::Base#head</a> method and <a href="http://dev.rubyonrails.org/browser/trunk/actionpack/lib/action_controller/status_codes.rb">HTTP status codes</a> are the second item on the list. The head method is very useful when you just want to respond with HTTP headers and no body content. This is typical behavior when an app responds to external web services requests. This is important to note, I chose to rely on head responses as a way to meet my design decision of not using any RJS responses from the controller.
</p>

<p>
  The basic usage of the head method is simple, you just pass a symbol to the head method that is the lowercase underscore equivalent to an HTTP status code. For instance, if you wanted to respond with success, choose a status code from the 200 range, the easiest being 'OK', which would look like <code>head(:ok)</code>. If you wanted to respond to bad authentication, you might use the 401 code like so, <code>head(:unauthorized)</code>. Here is an example from HomeMarks restful user signup action.
</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="no">User</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:user</span><span class="p">])</span>
    <span class="n">head</span> <span class="ss">:ok</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div>
<p>
  There is actually a number of things going on in those 2 lines of code above. If the user is created, the AJAX request will get a simple 'OK' message via the head method. Obviously the client will need to know what to do on its own. But if errors happen what to do? This brings us to...
</p>

<h2>Invalid Object Handling</h2>

<p>
  When Rails 2 came out, it gave us a very useful tool for our controllers, the <a href="http://api.rubyonrails.com/classes/ActionController/Rescue/ClassMethods.html">ActionController#rescue_from</a> method. It allows you to delegate exception handling to a method either per controller or site wide for a specific exception class. So enter the <a href="http://github.com/metaskills/homemarks/tree/master/lib/render_invalid_record.rb">RenderInvalidRecord</a> module, show below.
</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">RenderInvalidRecord</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">base</span><span class="p">.</span><span class="nf">rescue_from</span><span class="p">(</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">RecordInvalid</span><span class="p">,</span> <span class="ss">:with</span> <span class="o">=&gt;</span> <span class="ss">:render_invalid_record</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">protected</span>

  <span class="k">def</span> <span class="nf">render_invalid_record</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">exception</span><span class="p">.</span><span class="nf">record</span>
    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">html</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="nf">new_record?</span> <span class="p">?</span> <span class="s1">'new'</span> <span class="p">:</span> <span class="s1">'edit'</span><span class="p">)</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">js</span>   <span class="p">{</span> <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span><span class="p">,</span> <span class="ss">:content_type</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">xml</span>  <span class="p">{</span> <span class="n">render</span> <span class="ss">:xml</span> <span class="o">=&gt;</span> <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">,</span>  <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span> <span class="p">}</span>
      <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="p">{</span> <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">record</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="ss">:unprocessable_entity</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<p>
  Once included in your application.rb file, every ActiveRecord::RecordInvalid exception will be handled by the render_invalid_record method. I use this pattern often and it is the primary reason I always use the <strong>bang methods</strong> that end with an exclamation point, such as <code>create!</code> or <code>save!</code>. This module above was inspired by <a href="http://github.com/josh/">Joshua Peek's</a> own module of the same name but has been edited here to fit my needs. Both the "xml" and "html" response formats are not used by HomeMarks but are included here to show how this module can work for any request type.
</p>

<p>
  Now, how this fits into the AJAX Head pattern. The design decision of not having RJS responses means one of two things needs to come from the response. First, if the response is a success, meaning in the 200 range, then it is assumed that the client only needs to know that all is 'OK'. Second, if the request has errors, then the response needs to communicate them. I choose JSON for the format of these errors since all AJAX request objects from Prototype automatically include a <code>application/json</code> accept header. So that is why I changed both the "js" and the "json" response type in the RenderInvalidRecord module to both serialize the objects full error messages into a JSON array with an HTTP status code of 422 "Unprocessable Entity" which seemed to make the most sense to me. This pretty much wraps up the server side part of the pattern. Now onto the client side. Everything from here on is personal taste on how your client will react to an "good" or "bad" response object.
</p>

<h2>Client-Side AJAX Handlers</h2>

<p>
  I can not stress enough how much you have to bake your own functions to handle the client side reaction to both good and bad AJAX responses. The client's ability to know what to do with errors will be tightly coupled to AJAX handlers and the design choices of your site. In the examples below I have broken up methods in the same JavaScript classes to show you the parts for a specific behavior in a more concise manner. Also please note that I am using Prototype module and class organization heavily in HomeMarks. This allows me to build a Base JavaScript module and classes that mimic Rails models which inherit/mixin Base methods. I also use the Scriptaculous Builder class for creating DOM fragments too. Now back to business.
</p>

<div class="center">
  <video title="HomeMarks v2 Signup" src="/assets/signup.mp4" width="617" height="473" controls preload></video>
</div>

<p>
  </a>The first part of the AJAX head pattern was to use unobtrusive JavaScript. Because of this design choice, there are no <code>remote_form_for</code> methods in the HomeMarks view code. All forms are simple <code>form_for</code> methods. Below is a sample of the HomeMarksSite JavaScript class that creates AJAX handlers for all site forms. The below example is slimmed down to only show the initialization of this behavior for the signup form. But no matter which form is given this behavior the process is the same.
</p>

<ul class="ml20 mr20 mb20">
  <li>The form's submit event is handled by <code>startAjaxForm()</code>. It does the following:</li>
    <ul>
      <li>Stops the normal submit behavior.</li>
      <li>Adds a loading spinner in the #form_loading span.</li>
      <li>Creates a new AJAX.Request using the forms own action. It also binds a function to delegate the logic of completing the form when the request is finished. More on that later in #2 below.</li>
      <li>Finally it disables the form.</li>
    </ul>
  <li>Once a response comes back from the server, the <code>delegateCompleteAjaxForm()</code> function will be called with both the form object and the AJAX request object. The logic of this function includes:</li>
  <ul>
    <li>Figuring out the "mood" of the request using getRequestMood() function which is part of my base module.</li>
    <li>Sends the form and mood to the <code>completeAjaxForm()</code> function. This function will replace the loading spinner with an image that reflects a good or bad response.</li>
    <li>If the mood is good, meaning the response status code was within a 200 range, then the function will delegate to a function specific for that forms success using a simple case statement.</li>
    <li>If this mood is bad, meaning the response status code not within a 200 range, the form will be enabled and the response JSON errors will be displayed. Currently I am using a modal class for this. Again more on that later. You may also note that my base module has a function called <code>messagesToList()</code> that process the response into a DOM &lt;ul&gt; list.</li>
  </ul>
</ul>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">HomeMarksBase</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">getRequestMood</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">)</span> <span class="p">?</span> <span class="s1">'good'</span> <span class="p">:</span> <span class="s1">'bad'</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">messagesToList</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">messageList</span> <span class="o">=</span> <span class="nx">UL</span><span class="p">();</span>
    <span class="nx">messages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span>
      <span class="nx">messageList</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">LI</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">escapeHTML</span><span class="p">())</span> <span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">messageList</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">HomeMarksSite</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HomeMarksBase</span><span class="p">,{</span>
  <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">signupForm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'signup_form'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initEvents</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">startAjaxForm</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="s1">'form'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="na">imgSrc</span><span class="p">:</span><span class="s1">'loading_invert.gif'</span><span class="p">},</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
    <span class="kd">var</span> <span class="nx">loadArea</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">down</span><span class="p">(</span><span class="s1">'#form_loading'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">imgTag</span> <span class="o">=</span> <span class="nx">IMG</span><span class="p">({</span><span class="na">src</span><span class="p">:(</span><span class="s1">'/images/'</span><span class="o">+</span><span class="nx">options</span><span class="p">.</span><span class="nx">imgSrc</span><span class="p">)});</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">loadArea</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">imgTag</span><span class="p">);</span>
    <span class="k">new</span> <span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">action</span><span class="p">,{</span>
      <span class="na">onComplete</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">){</span> <span class="k">this</span><span class="p">.</span><span class="nx">delegateCompleteAjaxForm</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span><span class="nx">request</span><span class="p">)</span> <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
      <span class="nx">parameters</span><span class="err">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="p">});</span>
    <span class="nx">form</span><span class="p">.</span><span class="nx">disable</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">delegateCompleteAjaxForm</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mood</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getRequestMood</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">completeAjaxForm</span><span class="p">(</span><span class="nx">form</span><span class="p">,{</span><span class="na">mood</span><span class="p">:</span><span class="nx">mood</span><span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">mood</span> <span class="o">==</span> <span class="s1">'good'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="k">this</span><span class="p">.</span><span class="nx">supportForm</span> <span class="err">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">completeSupportForm</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">form</span><span class="p">.</span><span class="nx">enable</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nx">blank</span><span class="p">())</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">flashHTML</span> <span class="o">=</span> <span class="nx">DIV</span><span class="p">([</span><span class="nx">H2</span><span class="p">(</span><span class="s1">'Errors On Form!'</span><span class="p">),</span><span class="k">this</span><span class="p">.</span><span class="nx">messagesToList</span><span class="p">(</span><span class="nx">request</span><span class="p">)]);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">flashModal</span><span class="p">(</span><span class="s1">'bad'</span><span class="p">,</span><span class="nx">flashHTML</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">completeAjaxForm</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="na">mood</span><span class="p">:</span><span class="s1">'good'</span><span class="p">},</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">{});</span>
    <span class="kd">var</span> <span class="nx">loadArea</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">down</span><span class="p">(</span><span class="s1">'#form_loading'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">completeId</span> <span class="o">=</span> <span class="s1">'complete_ajax_form_'</span> <span class="o">+</span> <span class="nx">form</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">imgSrc</span> <span class="o">=</span> <span class="s1">'/images/'</span><span class="o">+</span><span class="nx">options</span><span class="p">.</span><span class="nx">mood</span><span class="o">+</span><span class="s1">'.png'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">moodHtml</span> <span class="o">=</span> <span class="nx">SPAN</span><span class="p">({</span><span class="na">id</span><span class="p">:</span><span class="nx">completeId</span><span class="p">,</span><span class="na">className</span><span class="p">:</span><span class="s1">'m0 p0'</span><span class="p">},</span> <span class="p">[</span><span class="nx">IMG</span><span class="p">({</span><span class="na">src</span><span class="p">:</span><span class="nx">imgSrc</span><span class="p">})]);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">loadArea</span><span class="p">).</span><span class="nx">update</span><span class="p">(</span><span class="nx">moodHtml</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nx">completeId</span><span class="p">).</span><span class="nx">fade</span><span class="p">();</span> <span class="p">},</span><span class="mi">3000</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">completeSignupForm</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">"Thank your for signing up for your own HomeMarks page. An email has been sent to "</span> <span class="o">+</span>
      <span class="s2">"your address along with a link to activate your account. If you have not done so already, please "</span> <span class="o">+</span>
      <span class="s2">"take a moment to read the HomeMarks documentation."</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">flashHTML</span> <span class="o">=</span> <span class="nx">DIV</span><span class="p">([</span><span class="nx">H2</span><span class="p">(</span><span class="s1">'Signup Complete:'</span><span class="p">),</span><span class="nx">P</span><span class="p">(</span><span class="nx">message</span><span class="p">)]);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">'good'</span><span class="p">,</span><span class="nx">flashHTML</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">initEvents</span><span class="err">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">signupForm</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">signupForm</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">'submit'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">startAjaxForm</span><span class="p">.</span><span class="nx">bindAsEventListener</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">};</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h2>Client-Side Error Handling</h2>

<p>
  Currently I have 3 client-side options that I can use to present errors back to the user from the JSON array in AJAX response. The first I started out with was using the <code>alert()</code> function. That got boring real quick, but I left my implementation below which is part of the base class, called <code>messagesToAlert()</code>.
</p>

<p>
  The second slightly more interesting way was to create a flash message that used the same XHTML/CSS already present in my layout file. This was real easy to implement. Basically using the ERB fragment below in my layout, I guaranteed that I had 3 unique DOM elements for each of my flash message styles, good/bad/indif. Now all I had to do was to create an accessor in my HomeMarksSite class. I choose <code>this.flashes</code>. I then created a <code>clearFlashes()</code> function and then a <code>flash()</code> function that would take the mood and the HTML to embed, viola â€“ I can now call <code>this.flash.('good',someHTML)</code> and I get the same type of flash one would have seen if I set it in the controller and rendered. Note, this is what I used on the the signup form success above.
</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">&lt;</span><span class="sx">% [:good,:bad,:indif].each </span><span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="sx">%&gt;
  &lt;div id="flash_&lt;%= key %&gt;</span><span class="s2">" class="</span><span class="n">flash_message</span><span class="s2">" style="</span><span class="nb">display</span><span class="p">:</span><span class="o">&lt;</span><span class="sx">%= flash[key].blank? ? 'none' : 'block' %&gt;;"&gt;
      &lt;span&gt;&lt;%=</span> <span class="n">flash</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">%&gt;&lt;</span><span class="sr">/span&gt;
    &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</code></pre></div>
<p><br /></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">HomeMarksBase</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">messagesToAlert</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">alertText</span> <span class="o">=</span> <span class="nx">messages</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">".\n"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">alertText</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="nx">alertText</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="nx">alertText</span><span class="o">+</span><span class="s1">'.'</span><span class="p">);</span> <span class="p">};</span>
  <span class="p">},</span>
  <span class="nx">messagesToList</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseJSON</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">messageList</span> <span class="o">=</span> <span class="nx">UL</span><span class="p">();</span>
    <span class="nx">messages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">){</span>
      <span class="nx">messageList</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span> <span class="nx">LI</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">escapeHTML</span><span class="p">())</span> <span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">messageList</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">HomeMarksSite</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HomeMarksBase</span><span class="p">,{</span>
  <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">flashes</span> <span class="o">=</span> <span class="nx">$$</span><span class="p">(</span><span class="s1">'div.flash_message'</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">clearFlashes</span><span class="err">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">flashes</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">'hide'</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">flashes</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">'update'</span><span class="p">,</span><span class="s1">''</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">flash</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mood</span><span class="p">,</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">clearFlashes</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">moodFlash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">flashes</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="s1">'flash_'</span><span class="o">+</span><span class="nx">mood</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="kc">true</span><span class="p">};</span> <span class="p">});</span>
    <span class="nx">moodFlash</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="nx">moodFlash</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'site_wrapper'</span><span class="p">).</span><span class="nx">scrollTo</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<div class="center">
  <video title="HomeMarks v2 Signup" src="/assets/login.mp4" width="617" height="473" controls preload></video>
</div>

<p>
  Lastly, and probably the coolest, is the HomeMarksModal JavaScript class I created. This is my new default way of errors to a user. It can be seen in all my video examples on this page. To the right is another example of the login form that uses the same handlers described above. The HomeMarksModal JavaScript class is a bit large to paste inline in this article, but if you want to see the latest version, you can always get it <a href="http://github.com/metaskills/homemarks/tree/master/public/javascripts/homemarks/modal.js">from the master branch of the homemarks_core project</a> on Github.com. When you bind an instance of this object to the window/document, it will automatically crate the modal HTML using Builder. If you want to use it, make sure to get the CSS and images the project too. Below is a function that I put in my site class that allows me to call <code>this.flashModal('good',someHTML))</code>.
</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">HomeMarksSite</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">HomeMarksBase</span><span class="p">,{</span>
  <span class="na">flashModal</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mood</span><span class="p">,</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">moodColor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">flashMoodColors</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">mood</span><span class="p">);</span>
    <span class="nx">HmModal</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">html</span><span class="p">,{</span><span class="na">color</span><span class="p">:</span><span class="nx">moodColor</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h2>Wrapping It Up</h2>

<p>
  This article turned out a lot longer than I had wanted. The AJAX head pattern is pretty simple and it is really fun to see a two line user signup action yield such interactive results. Something also feels good about not putting view code in the controller, yes you can look at inline RJS as view code. Sure it requires that you do a lot more JS work, but there are benefits.
</p>

<p>
  Image you have team of programmers, one person can stay in model/controller land while the other stays on the view/javascript. The model/controller person would write their own tests (PLEASE TAKE A LOOK AT MINE), while the view/javascript person might even take the initiative to use selenium to test the JavaScript. At the time of this writing, I have not done any selenium tests since the plugin for rails is not compatible for 2.0. That last benefit I could think of for this design pattern is that you could easily update view code without restarting your rails app. Just update the JavaScripts and your good to go.
</p>

<p>
  In closing, please let me know what you think. Perhaps you have a better name for the design pattern? Perhaps someone else has a name for it already?
</p>

<h2>Resources</h2>

<ul>
  <li>Original <a href="http://github.com/metaskills/homemarks/tree/d33dab1405537db2d2dab86d79db415d9e7f56e5/app/helpers/application_helper.rb">application_helper.rb</a> from HomeMarks v1. An overboard example of shared view/controller tagsoup/rjs.</li>
  <li>The latest <a href="http://www.pragprog.com/titles/fr_arr/advanced-rails-recipes"><em>Advanced Rails Recipes</em></a> book. See the chapter on "Replace In-View Raw JavaScript". I discourage this technique used in mass.</li>
  <li>Rails API for the <a href="http://api.rubyonrails.com/classes/ActionController/Base.html#M000454">ActionController::Base#head</a> method.</li>
  <li>Rails API for the <a href="http://dev.rubyonrails.org/browser/trunk/actionpack/lib/action_controller/status_codes.rb">HTTP status codes</a>.</li>
  <li>Rails API for the <a href="http://api.rubyonrails.com/classes/ActionController/Rescue/ClassMethods.html">ActionController#rescue_from</a> method.</li>
  <li>The latest <a href="http://github.com/metaskills/homemarks/tree/master/lib/render_invalid_record.rb">RenderInvalidRecord</a> module from the HomeMarks core.</li>
  <li>The latest  <a href="http://github.com/metaskills/homemarks/tree/master/public/javascripts/homemarks/modal.js">HomeMarksModal</a> JavaScript class from the HomeMarks core.</li>
</ul>

  <footer class="ms-Post-footer">
    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2008/05/24/the-ajax-head-br-design-pattern/';
  var disqus_title = "The "AJAX Head" Design Pattern";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  </footer>
</article>

    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2008/05/24/the-ajax-head-br-design-pattern/';
  var disqus_title = "The "AJAX Head" Design Pattern";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


    <footer class="ms-Footer">
  <p>
    &copy; 2006-2014 Ken Collins. All rights reserved.<br/>
    MetaSkills.net is powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://disqus.com">Disqus</a>.
  </p>
</footer>

  </article>
</section>

    <script src="/assets/site-5b742dd84d08dc11c2e75947ba53428e.js"></script>
  </body>
</html>
