<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ken Collins" />
  <meta name="google-site-verification" content="W3DG-CkoWHypH24OfrGmGbMezvhC6AyLql4jLI7hXhI" />
  <meta name="description" content="The personal blog of Ken Collins aka MetaSkills" />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cleartype" content="on">
  
  <title>MultiRuby The MacPorts Way. Testing Your Rails Apps With Ruby 1.9 - Ken Collins @MetaSkills.net</title>
  <link rel="author" href="mailto:ken@metaskills.net" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/site/icon-57x57.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/site/icon-114x114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/site/icon-72x72.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/site/icon-144x144.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/assets/site/icon-60x60.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/assets/site/icon-120x120.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/assets/site/icon-76x76.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/assets/site/icon-152x152.png">
  <link rel="icon" type="image/png" sizes="196x196" href="/assets/site/icon-196x196.png">
  <link rel="icon" type="image/png" sizes="160x160" href="/assets/site/icon-160x160.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/site/icon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/site/icon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/site/icon-32x32.png">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://metaskills.net/feed.xml" />
  <meta name="apple-mobile-web-app-title" content="MetaSkills">
  <meta name="application-name" content="MetaSkills" />
  <meta name="msapplication-TileImage" content="/assets/site/icon-144x144.png">
  <meta name="msapplication-TileColor" content="052838">
  <link rel="stylesheet" href="/assets/site.css">
</head>

  <body>
    <section class="ms-Page ">
  <header class="ms-Page-header">
    <section class="ms-Page-header-bg">
      <object class="ms-Page-header-bg-svg" data="/assets/site/page-svg.svg" type="image/svg+xml"></object>
    </section>
    <section class="ms-Page-header-content">
      <div class="ms-Page-header-avatar">
<a class="ms-Avatar" href="/pages/colophon.html" title"About Ken Collins">
  <div class="ms-Avatar-flipable">
    <div class="ms-Avatar-front">
      <img class="ms-Avatar-img" alt="Ken Collins" src="/assets/site/avatar.jpg">
    </div>
    <div class="ms-Avatar-back">
      <svg class="ms-Avatar-aboutme" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="350px" height="47px" viewBox="0 0 350 47" preserveAspectRatio="xMidYMax meet" version="1.1"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(1.000, 1.000)"><path d="M161.250 4.91 L-0.014 -0.12 L17.975 44.67 L178.787 37.22 L330.559 44.67 L347.824 -0.12 L161.250 4.91 Z" fill="#E4522A"/><g stroke="#FFFBE1"><path d="M275.89 25.53 L290.71 25.53 L287.55 20.31 L321.9 20.31 "/><path d="M276.55 22.54 L291.36 22.54 L288.2 17.33 L322.56 17.33 "/></g><g stroke="#FFFBE1"><path d="M72.76 25.53 L57.94 25.53 L61.1 20.31 L26.75 20.31 "/><path d="M72.1 22.54 L57.29 22.54 L60.45 17.33 L26.09 17.33 "/></g></g><path d="M89.184 15.23 L81.776 15.23 L81.724 15.52 C83.226 16.68 83.64 17.12 83.64 18.6 L83.641 31.76 L89.184 31.76 L89.184 27.43 L90.842 27.43 C91.955 27.43 92.19 28.05 92.19 29.04 L92.189 31.76 L97.732 31.76 L97.732 27.98 C97.732 24.92 96.9 24.04 93.64 24.04 L98.327 15.23 L92.189 15.23 L89.184 24.74 L89.184 15.23 Z M113.357 25.72 L113.357 21.99 L109.109 21.99 L109.109 19.14 L115.247 19.14 L115.247 15.23 L101.701 15.23 L101.649 15.52 C103.151 16.68 103.57 17.12 103.57 18.6 L103.566 31.76 L115.507 31.76 L115.507 28.03 L109.109 28.03 L109.109 25.72 L113.357 25.72 Z M119.346 15.23 L119.294 15.52 C120.797 16.68 121.21 17.12 121.21 18.6 L121.211 31.76 L126.754 31.76 L126.754 18.83 L129.008 18.83 C129.888 18.83 130.02 19.12 130.02 20 L130.018 31.76 L135.561 31.76 L135.561 19.84 C135.561 16.48 134.68 15.23 131.05 15.23 L119.346 15.23 Z M161.112 25.88 L161.112 26.92 C161.112 28.05 160.91 28.37 160.08 28.37 L159.014 28.37 C158.160 28.37 157.95 28.05 157.95 26.92 L157.952 20.26 C157.952 19.12 158.16 18.86 159.01 18.86 L160.076 18.86 C160.905 18.86 161.11 19.12 161.11 20.26 L161.112 23 L166.707 23 L166.707 20.05 C166.707 16.43 165.8 15.23 162.43 15.23 L156.631 15.23 C153.264 15.23 152.36 16.43 152.36 20.05 L152.357 26.53 C152.357 30.72 153.89 31.76 156.92 31.76 L162.433 31.76 C165.801 31.76 166.71 30.88 166.71 27.12 L166.707 25.88 L161.112 25.88 Z M186.606 20.05 C186.606 16.43 185.7 15.23 182.33 15.23 L176.375 15.23 C173.008 15.23 172.1 16.43 172.1 20.05 L172.101 26.53 C172.101 30.72 173.63 31.76 176.66 31.76 L182.332 31.76 C185.700 31.76 186.61 30.88 186.61 27.12 L186.606 20.05 Z M181.011 26.92 C181.011 28.05 180.8 28.37 179.97 28.37 L178.758 28.37 C177.903 28.37 177.7 28.05 177.7 26.92 L177.696 20.26 C177.696 19.12 177.9 18.86 178.76 18.86 L179.975 18.86 C180.804 18.86 181.01 19.12 181.01 20.26 L181.011 26.92 Z M198.216 15.23 L190.808 15.23 L190.757 15.52 C192.259 16.68 192.67 17.12 192.67 18.6 L192.673 31.76 L203.863 31.76 L203.863 28.03 L198.216 28.03 L198.216 15.23 Z M214.230 15.23 L206.822 15.23 L206.770 15.52 C208.272 16.68 208.69 17.12 208.69 18.6 L208.687 31.76 L219.877 31.76 L219.877 28.03 L214.230 28.03 L214.230 15.23 Z M230.244 15.23 L222.836 15.23 L222.784 15.52 C224.286 16.68 224.7 17.12 224.7 18.6 L224.700 31.76 L230.244 31.76 L230.244 15.23 Z M234.653 15.23 L234.601 15.52 C236.103 16.68 236.52 17.12 236.52 18.6 L236.518 31.76 L242.061 31.76 L242.061 18.83 L244.314 18.83 C245.195 18.83 245.32 19.12 245.32 20 L245.325 31.76 L250.868 31.76 L250.868 19.84 C250.868 16.48 249.99 15.23 246.36 15.23 L234.653 15.23 Z M268.410 15.23 L258.696 15.23 C256.805 15.23 256.13 16.06 256.13 17.36 C256.132 17.88 256.37 18.55 256.7 19.07 L261.753 27.07 C261.830 27.18 261.88 27.36 261.88 27.51 C261.882 27.82 261.65 28.03 261.18 28.03 L255.743 28.03 L255.743 31.76 L266.130 31.76 C268.073 31.76 268.8 30.49 268.8 29.45 C268.798 28.75 268.49 28.21 268.18 27.74 L262.970 20.13 C262.841 19.92 262.76 19.77 262.76 19.61 C262.763 19.33 263.02 19.14 263.49 19.14 L268.410 19.14 L268.410 15.23 Z" fill="#FFFBE1"/></g></svg>

    </div>
  </div>
</a>
</div>
      <ul class="ms-Page-nav">
        <li class="ms-Page-nav-item">
          <a class="ms-Page-nav-link" href="/">HOME</a>
        </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/programming.html">Programming</a>
          </li>
        
          
          
          <li class="ms-Page-nav-item">
            <a class="ms-Page-nav-link" href="/categories/lifestyle.html">Lifestyle</a>
          </li>
        
      </ul>
      <div class="ms-Page-social"><div class="ms-Social">
  <a href="http://twitter.com/metaskills" title="MetaSkills On Twitter">
    <span class="ms-Social-icon ms-Social-icon--twitter"><i class="icon-twitter"></i></span>
  </a>
  <a href="https://github.com/metaskills/" title="MetaSkills On GitHub">
    <span class="ms-Social-icon ms-Social-icon--github"><i class="icon-github"></i></span>
  </a>
  <a href="http://www.linkedin.com/in/metaskills" title="Ken Collins On LinkedIn">
    <span class="ms-Social-icon ms-Social-icon--linkedin"><i class="icon-linkedin"></i></span>
  </a>
</div>
</div>
      <div class="ms-Page-blurb">
        Ruby, JavaScript, Sass, iOS. Stinky Cheese &amp; Beer Advocate. Working at CustomInk and loving it!
      </div>
    </section>
  </header>
  <article class="ms-Page-article">
    <article class="ms-Post">
  <header class="ms-Post-header">
    <time class="ms-Post-time" pubdate datetime="2009-01-20T00:00:00-05:00">
      2009 January 20
    </time>
    <h1 class="ms-Post-header-h1">MultiRuby The MacPorts Way. Testing Your Rails Apps With Ruby 1.9</h1>
  </header>
  <aside class="ms-Flash">
  UPDATE: In a recent article, I <a href="/2009/10/27/installing-ree-with-the-snow-leopard-sql-server-stack/">covered how to install REE</a> and have hence NOOP'ed this function to ignore the symlinking when REE is installed.
</aside>

<p>
  Ruby 1.9.1, the stable release, is just around the corner and if your like me, maybe you want to start playing around with it and perhaps test a few projects using 1.9 with edge rails 2.3. If so, and your on a Mac, then perhaps this installation method might appeal to you. I'll break this article up in two parts, the first will be on installing multiple versions of ruby and how to switch between them while the other will be some things I noticed when testing ruby 1.9 with edge rails on my favorite pet project <a href="http://github.com/metaskills/homemarks/tree/master">HomeMarks</a>.
</p>

<h2>Installing Ruby 1.9 & Change Ruby Function</h2>

<p>
  I love MacPorts and recommend using it even though OS X comes with ruby pre-installed. Doing so simply keeps things clean and separated in the <code>/opt</code> directory vs mixing things in /usr where they might be clobbered by Apple during a system update. So no to dependency hell! This article assumes you already have ruby 1.8 installed via MacPorts, if not change some of the paths in the provided code below. Now... thanks to MacPorts it is easier than ever to get ruby 1.9 preview release 2 installed in it's own separate space.
</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ sudo port install ruby19
</code></pre></div>
<p>
  MacPort has just added these ruby 1.9 binaries to your PATH in <code>/opt/local/bin</code>. Nice and clean egh? From here you can start "playing" with 1.9 by just executing either <code>ruby1.9</code> or <code>irb1.9</code>, but that gets boring quick.
</p>

<ul>
  <li>erb1.9</li>
  <li>gem1.9</li>
  <li>irb1.9</li>
  <li>rake1.9</li>
  <li>rdoc1.9</li>
  <li>ri1.9</li>
  <li>ruby1.9</li>
  <li>testrb1.9</li>
</ul>

<p>
  Let's hack up your setup so that you can quickly switch your whole ruby install back and forth transparently. The first step is to move the corresponding ruby 1.8 binaries to the same naming convention as their 1.9 counterparts. We will then use symlinks to change which one gets executed. Step one:
</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ sudo mv /opt/local/bin/erb /opt/local/bin/erb1.8
$ sudo mv /opt/local/bin/gem /opt/local/bin/gem1.8
$ sudo mv /opt/local/bin/irb /opt/local/bin/irb1.8
$ sudo mv /opt/local/bin/rake /opt/local/bin/rake1.8
$ sudo mv /opt/local/bin/rdoc /opt/local/bin/rdoc1.8
$ sudo mv /opt/local/bin/ri /opt/local/bin/ri1.8
$ sudo mv /opt/local/bin/ruby /opt/local/bin/ruby1.8
$ sudo mv /opt/local/bin/testrb /opt/local/bin/testrb1.8
</code></pre></div>
<p>
  So now that we have two versions of ruby installed, each in their own path suffix. So to switch back and forth without using these suffixes, we will need to create a symlink for each binary that points to the version we want to use. The users of the local ruby group <a href="http://757rb.org/">757rb</a> came up with this ZSH function below. Place it into your <a href="http://github.com/metaskills/zshkit/tree/master">.zshkit</a> or dotfile of choice and it will create/change symlinks for your ruby, irb, rake, etc.. that each point to the version you want to use. Calling it multiple times will simply toggle your ruby versions.
</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">chruby <span class="o">()</span> <span class="o">{</span>
  <span class="nv">ree</span><span class="o">=</span><span class="sb">`</span>ruby -e <span class="s2">"puts RUBY_DESCRIPTION.include?('Ruby Enterprise Edition')"</span><span class="sb">`</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$ree</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span>; <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"NOOP: Currently using REE in your path."</span>
  <span class="k">else
    </span><span class="nv">v</span><span class="o">=</span><span class="sb">`</span>ruby -e <span class="s2">"puts RUBY_VERSION.split('.')[0,2].join('.')"</span><span class="sb">`</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$v</span> <span class="o">=</span> <span class="s2">"1.9"</span> <span class="o">]</span>; <span class="k">then
      </span><span class="nv">cv</span><span class="o">=</span><span class="s2">"1.8"</span>
    <span class="k">else
      </span><span class="nv">cv</span><span class="o">=</span><span class="s2">"1.9"</span>
    <span class="k">fi
    </span><span class="nv">rubyexes</span><span class="o">=(</span>erb gem irb rake rdoc ri ruby testrb autotest unit_diff rails<span class="o">)</span>
    <span class="k">for </span>i <span class="k">in</span> <span class="nv">$rubyexes</span>; <span class="k">do
      </span>sudo unlink <span class="s2">"/opt/local/bin/</span><span class="k">${</span><span class="nv">i</span><span class="k">}</span><span class="s2">"</span>
      sudo ln -s <span class="s2">"/opt/local/bin/</span><span class="k">${</span><span class="nv">i</span><span class="k">}${</span><span class="nv">cv</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"/opt/local/bin/</span><span class="k">${</span><span class="nv">i</span><span class="k">}</span><span class="s2">"</span>
    <span class="k">done
    </span><span class="nb">echo</span> <span class="s2">"Now Running: "</span><span class="sb">`</span>ruby -v<span class="sb">`</span>
  <span class="k">fi</span>
<span class="o">}</span>
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">$ chruby
Now Running: ruby 1.8.7 (2008-08-11 patchlevel 72) [i686-darwin9]
$ chruby
Now Running: ruby 1.9.1 (2008-12-01 revision 20438) [i386-darwin9]
</code></pre></div>
<p>
  This works amazingly well at first. The one big gotcha is that you have to remember you have two gems directories. Any gem you installed under 1.8 will have to be installed again under 1.9. There are ways around this with some clever symlinking, but I'd recommend against it. Note too, this also applies to any site/vendored libs or bundles, for instance ruby odbc.
</p>

<h3>Things To Watch Out For</h3>

<p>
  If you install a gem under a certain version of ruby that places an executable in say /opt/local/bin then you are going to want to watch out for a bad she bang. For instance if you install the ZenTest gem while running under ruby1.9 suffix, then the she bang for <code>/opt/local/bin/autotest</code> would be incorrectly set to this <code>#!/opt/local/bin/ruby1.9 -ws</code>. The simple fix is to just change it to the true sym link.
</p>

<h2>Exploring Rails 2.3 & Ruby 1.9</h2>

<p>
  So far my HomeMarks project does not have any major issues with ruby 1.9. I'm not surprised, it's very very slim ruby code due to the <a href="/2008/05/24/the-ajax-head-design-pattern/">AJAX head design pattern</a>. I did however find a few new things about the changes an app will need when moving from 2.2 to 2.3.
</p>

<ul>
  <li>Your test/test_helper.rb file will need to change to from <code>class Test::Unit::TestCase</code> to <code>class ActiveSupport::TestCase</code>. I'm sure this change is related to future abstraction to choose Minitunit vs Test::Unit.</li>
  <li>They have finally changed <code>app/controllers/application.rb</code> to <code>app/controllers/application_controller.rb</code>. Finally their hacks on that bad name are now gone. I found that I had to do this change manually on my own.</li>
  <li>Disabling sessions for a single controller has been deprecated. Sessions are now lazy loaded. So if you don't access them, consider them off. You can still modify the session cookie options with request.session_options.</li>
</ul>

<p>
  Past that, about the only interesting thing I found in Ruby 1.9 was that Test::Unit is gone and is actually loading Miniunit. So things in rails that were requiring test/unit/error are going to fail.
</p>

  <footer class="ms-Post-footer">
    

<section id="disqus_thread">
</section>
<script type="text/javascript">
  var disqus_shortname = 'metaskillsnet';
  var disqus_identifier = '/2009/01/20/multiruby-the-macports-way-testing-your-rails-apps-with-ruby-1-9/';
  var disqus_title = "MultiRuby The MacPorts Way. Testing Your Rails Apps With Ruby 1.9";
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  </footer>
</article>

    
    <footer class="ms-Footer">
  <p>
    &copy; 2006-2015 Ken Collins. All rights reserved.<br/>
    MetaSkills.net is powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://disqus.com">Disqus</a>.
  </p>
</footer>

  </article>
</section>

    <script src="/assets/site.js"></script>
  </body>
</html>
